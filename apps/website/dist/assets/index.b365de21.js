var et=Object.defineProperty,tt=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var ae=(t,e,r)=>e in t?et(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,O=(t,e)=>{for(var r in e||(e={}))le.call(e,r)&&ae(t,r,e[r]);if(I)for(var r of I(e))ce.call(e,r)&&ae(t,r,e[r]);return t},U=(t,e)=>tt(t,rt(e));var W=(t,e)=>{var r={};for(var s in t)le.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&I)for(var s of I(t))e.indexOf(s)<0&&ce.call(t,s)&&(r[s]=t[s]);return r};import{j as l,a as n,r as h,D as xe,l as R,b,c as o,L as K,C as st,e as _e,t as he,i as it,F as nt,R as ot,d as at}from"./vendor.f9e32ea5.js";const lt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}};lt();function Q(t,e=8){return String(t).padStart(e,"0")}function ct({errors:t}){return l("div",{className:"",children:[n("h1",{className:"pb-1 text-xl font-bold text-violet-400",children:"Errors:"}),t.map((e,r)=>{const s=Q(r+1,2);return l("div",{className:"flex flex-row font-mono text-xs",children:[l("div",{className:"font-bold text-red-400",children:["E",s,":"]}),n("div",{className:"text-red-600",children:n("pre",{children:JSON.stringify(e,null," ")})})]},s)})]})}const ue=({group:t,locations:e})=>l("div",{className:"flex flex-row mb-1",children:[l("div",{className:"flex flex-col",children:[n("div",{className:"text-blue-400",children:Q(t-53,3)}),n("div",{className:"text-blue-400",children:t===53?"EXT":`G${t}`})]}),n("div",{className:"flex flex-col flex-grow pr-10",children:Object.entries(e).map(([r,s])=>l("div",{className:"flex flex-row",children:[n("div",{className:"w-12 pt-px pr-3 text-right text-violet-100",children:r}),n("div",{className:"flex-grow pl-1 border-t border-l bg-violet-100 border-l-black border-t-black",children:s})]}))})]}),ht=({memory:t})=>{const e=[53,54,55,56].map(s=>[s,t.getAxisLocations(s)]),r=[57,58,59].map(s=>[s,t.getAxisLocations(s)]);return l("div",{className:"container",children:[n("h1",{className:"px-2 py-3 text-3xl border-b shadow-neutral-800 bg-neutral-800 border-b-violet-600 text-violet-500",children:"Work Coordinates"}),n("div",{className:"flex flex-col",children:n("div",{className:"pb-4 border-t border-t-purple-600",children:l("div",{className:"container",children:[l("div",{className:"grid grid-flow-row grid-cols-2 px-4 pt-2 font-mono",children:[l("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]}),l("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]})]}),l("div",{className:"grid grid-flow-row grid-cols-2 px-4 pt-2 font-mono",children:[n("div",{children:e.map(([s,i])=>n(ue,{group:s,locations:i}))}),n("div",{children:r.map(([s,i])=>n(ue,{group:s,locations:i}))})]})]})})})]})},de=({macros:t})=>l("div",{className:"flex flex-col gap-1 px-4 pt-2 font-mono",children:[l("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]}),t.map(e=>l("div",{className:"flex flex-row",children:[l("div",{className:"w-12 pt-px text-blue-400",children:["#",Q(e[0],4)]}),n("div",{className:"flex-grow pl-1 border-t border-l bg-violet-100 border-l-black border-t-black",children:e[1].toFixed(10)})]},e[0]))]});function ut(t){return{registerCustomLanguage(e,r){return gt(t,e,r)},registerCustomTheme(e,r){return mt(t,e,r)}}}function dt(t,e){return{brackets:t,tokenizer:{root:e}}}function Te(t,e={base:"vs",inherit:!1}){return O(O({},e),t)}function mt(t,e,r){return t.editor.defineTheme(e,r),t}function gt(t,e,r){return t.languages.register({id:e}),t.languages.setMonarchTokensProvider(e,r),t}const pt=dt([["[","]","delimeter.bracket"]],[[/#\d/,"macro-var"],[/\(.+\)/,"comment"],[/[\=\+\-\*\/]/,"operators"],[/(\d+(?:\.\d+)?)/,"number"]]),ft=Te({rules:[{token:"comment",foreground:"#C09D70",fontStyle:"italic"}],colors:{}},{base:"vs-dark",inherit:!0}),Et=Te({rules:[{token:"custom-info",foreground:"808080"},{token:"custom-error",foreground:"ff0000",fontStyle:"bold"},{token:"custom-notice",foreground:"FFA500"},{token:"custom-date",foreground:"008800"}],colors:{"editor.foreground":"#000000"}},{base:"vs",inherit:!1});function Nt(t){const{registerCustomLanguage:e,registerCustomTheme:r}=ut(t);return t.languages.typescript.javascriptDefaults.setEagerModelSync(!0),e("gcode",pt),r("gcode-dark",ft),r("gcode-light",Et),t}function Lt(t){const[e,r]=h.exports.useState(t);return[e,{setEditorThemeDark:()=>r("gcode-dark"),setEditorThemeLight:()=>r("gcode-light")}]}const vt=xe("macro"),T=t=>vt.extend(t),Ot=t=>xe.enable(t!=null?t:"macro:*"),bt=T("env"),xt=T("lexer"),_t=T("parser"),x=T("memory"),me=T("runtime"),m=T("interpreter");class Tt{constructor(e){this.value=e.value,this.ctx=e.prefix}}class Ct{constructor(){this._entries={}}collect(e){const r=this._entries[e.ctx];return Array.isArray(r)||(this._entries[e.ctx]=[]),this._entries[e.ctx].push(e),this.get(e.ctx).length}get(e){var r;return(r=this._entries[e])!=null?r:[]}values(e){return R.exports.map(this.get(e),"value")}uniqValues(e){return R.exports.uniq(this.values(e))}min(e){var r;return(r=R.exports.min(this.values(e)))!=null?r:NaN}max(e){var r;return(r=R.exports.max(this.values(e)))!=null?r:NaN}}function g(t){return Array.isArray(t)?t[0]:t}function ge(t){return t.replace(/^\(/,"").replace(/\)$/,"").trim()}function p(t){return g(t).image}function At(t){return t.replace(/^[A-Z]/,"")}function Ce(t){return t.includes(".")?parseFloat(t):parseInt(t)}function _(t,e){e=e+1;const r=(e-t)/1;return Array.from({length:r},(s,i)=>t+i)}function z(t){return t*Math.PI/180}function X(t){return 180/Math.PI*t}function Mt(t){const e=[],r=new We;if(t!=null&&t.preloadInput){const{errors:s,tokens:i}=r.Lexer.tokenize(t.preloadInput);s&&s.push(...s),r.Parser.input=i}return{errors:e,lexer:r.Lexer,parser:r.Parser,interpreter:r.Interpreter}}function St(t){return"G4"in t}function Ae(t){return"G10"in t}function Ut(t,{MATCH:e,NOMATCH:r}){const s=t.match(/^O([0-9]+)\s+?(?:\(.+?\))?$/m);return s===null?r("Program Number Not Found"):e(s)}const pe=20,Me={X:1,Y:2,Z:3,B:4};function fe(t,e){if(t<10||t>13)throw Error("Invalid tool group value.");return t*1e3+e}function Ee(t,e){if(t<0||t>6)throw Error(`Cannot compose a register from input: ${t}`);return{0:5200,1:5220,2:5240,3:5260,4:5280,5:5300,6:5320}[t]+Me[e]}function Ne(t,e){const r=t*pe;return 7e3-pe+r+Me[e]}const Rt={LENGTH_COMP:10,LENGTH:11,DIAMETER_COMP:12,DIAMETER:13},wt={COMMON:2,AUX:20},E={TOOL:Rt,WORK:wt};function Pt(t){const{addresses:e,gCodeMap:r}=t;if(!Ae(r))throw Error("G10 not found.");return e.reduce((s,i)=>U(O({},s),{[i.prefix]:i.value}),{})}function yt(t){const{errors:e,parser:r,interpreter:s}=Mt({preloadInput:t});if(e.length>0)return{error:e[0].message,result:null};const i=r.lines(),a=s.lines(i.children);return{error:null,result:Pt(a[0])}}const It=4003,{WORK:Le,TOOL:B}=E;function ve(t){return R.exports.pick(t,["X","Y","Z","B"])}const j=class{constructor(){this._vars={},this.write(It,90),this.reset()}read(t){const e=this._read(t);return x(`[READ ] #${t}= ${e}`),e}readBlocks(t,e){return _(t,t+e).map(r=>this.read(r))}write(t,e){x(`[WRITE] #${t}= ${e}`);const r=this._read(t);return this._write(t,e),{prev:r,curr:this._vars[t]}}clear(t){this._write(t,NaN)}reset(){j.REGISTERS.forEach(t=>this.clear(t)),x(`Initialized ${j.REGISTERS.length} registers`)}g10(t){return x("[ G10 ]",t),b.match(t).with({L:Le.COMMON},s=>{var i=s,{P:e}=i,r=W(i,["P"]);this.setCommonWorkOffset(e,ve(r))}).with({L:Le.AUX},s=>{var i=s,{P:e}=i,r=W(i,["P"]);this.setAuxWorkOffset(e,ve(r))}).with({L:B.LENGTH_COMP,R:b.__.number},({P:e,R:r})=>{this.setToolLengthComp(e,r)}).with({L:B.LENGTH,R:b.__.number},({P:e,R:r})=>{this.setToolLength(e,r)}).with({L:B.DIAMETER_COMP,R:b.__.number},({P:e,R:r})=>{this.setToolDiameterComp(e,r)}).with({L:B.DIAMETER,R:b.__.number},({P:e,R:r})=>{this.setToolDiameter(e,r)}).run()}evalG10(t){const{error:e,result:r}=yt(t);if(r)this.g10(r);else throw Error(e)}getAxisLocations(t){if(t<53||t>59)throw Error(`${t} is not a valid Work Coordinate Group`);return this._getCommonWorkOffsetAxisLocations(t)}getWorkCoordinates(t){const{X:e,Y:r,Z:s,B:i}=this.getAxisLocations(t);return[e,r,s,i]}getAuxWorkCoordinates(t){if(t<1||t>299)throw Error(`${t} is not a valid Aux Work Coordinate Group`);return this._getAuxWorkOffsetAxisLocations(t)}getToolOffsets(t){return{length:this.getToolLength(t),diameter:this.getToolDiameter(t),lengthComp:this.getToolLengthComp(t),diameterComp:this.getToolDiameterComp(t)}}setToolLength(t,e){this._setToolOffsetValue(t,E.TOOL.LENGTH,e)}getToolLength(t){return this._getToolOffsetValueByGroup(t,E.TOOL.LENGTH)}setToolLengthComp(t,e){this._setToolOffsetValue(t,E.TOOL.LENGTH_COMP,e)}getToolLengthComp(t){return this._getToolOffsetValueByGroup(t,E.TOOL.LENGTH_COMP)}setToolDiameter(t,e){this._setToolOffsetValue(t,E.TOOL.DIAMETER,e)}getToolDiameter(t){return this._getToolOffsetValueByGroup(t,E.TOOL.DIAMETER)}setToolDiameterComp(t,e){this._setToolOffsetValue(t,E.TOOL.DIAMETER_COMP,e)}getToolDiameterComp(t){return this._getToolOffsetValueByGroup(t,E.TOOL.DIAMETER_COMP)}setCommonWorkOffset(t,e){x("[O-SET]",`G${t+53}=`,e),Object.entries(e).forEach(([r,s])=>{const i=Ee(t,r);this.write(i,s)})}setAuxWorkOffset(t,e){x("[O-SET]",`G54.1 P${t}=`,e),Object.entries(e).forEach(([r,s])=>{const i=Ne(t,r);this.write(i,s)})}get forEach(){return Object.entries(this._vars)}toArray(t){const e=[];return Object.entries(this._vars).forEach(([r,s])=>{const i=s===null||isNaN(s);(s||i&&(t==null?void 0:t.includeUnset))&&e.push([parseInt(r),s])}),e}toObject(t){const e={};for(const[r,s]of this.toArray(t))e[r]=s;return e}serialize(){return JSON.stringify(this._vars)}_write(t,e){this._vars[t]=e}_read(t){var e;return(e=this._vars[t])!=null?e:NaN}_setToolOffsetValue(t,e,r){const s=fe(e,t);this.write(s,r)}_getToolOffsetValueByGroup(t,e){const r=fe(e,t);return this.read(r)}_getCommonWorkOffsetAxisLocations(t){return["X","Y","Z","B"].reduce((e,r)=>{const s=Ee(t-53,r);return U(O({},e),{[r]:this._vars[s]})},{})}_getAuxWorkOffsetAxisLocations(t){return["X","Y","Z","B"].reduce((e,r)=>{const s=Ne(t,r);return U(O({},e),{[r]:this._vars[s]})},{})}_increment(t,e){const r=this._vars[t];return this._vars[t]=r+e,{prev:r,curr:this._vars[t]}}};let J=j;J.REGISTERS=[..._(1,33),..._(100,199),..._(500,9999),..._(3e3,4999),..._(5e3,14e3)];const C=t=>o({name:t,pattern:K.NA}),ee=C("Brackets"),P=C("NumericValue"),N=C("BooleanOperator"),G=C("AdditionOperator"),A=C("ControlFlowKeyword"),D=C("MultiplicationOperator"),Bt=o({name:"EqualTo",pattern:/EQ/,categories:N}),kt=o({name:"NotEqualTo",pattern:/NE/,categories:N}),Vt=o({name:"LessThan",pattern:/LT/,categories:N}),Gt=o({name:"LessThanOrEq",pattern:/LE/,categories:N}),Dt=o({name:"GreaterThan",pattern:/GT/,categories:N}),Ft=o({name:"GreaterThanOrEq",pattern:/GE/,categories:N}),$t=o({name:"OpenParen",pattern:"("}),Wt=o({name:"CloseParen",pattern:")"}),k=o({name:"OpenBracket",pattern:"[",categories:ee}),V=o({name:"CloseBracket",pattern:"]",categories:ee}),Oe=/[O|:](\d+)/y;function zt(t,e){let r=null;if(Oe.lastIndex=e,r=Oe.exec(t),r!==null){const s=r[0];r.payload=parseInt(s.slice(1))}return r}const d=o({name:"Address",pattern:/[A-Z]/}),Se=o({name:"G_Code",pattern:/G\d+(\.\d+)?/,longer_alt:d}),Ue=o({name:"M_Code",pattern:/M\d+(\.)?/,longer_alt:d}),Re=o({name:"LineNumber",pattern:/N\d+/,longer_alt:d}),we=o({name:"ProgramNumber",pattern:zt,line_breaks:!0}),te=o({name:"Integer",pattern:/\d+/,categories:P}),Xt=o({name:"Decimal",pattern:/(?=\d*[.])([0-9]+\.?[0-9]*|\.[0-9]+)/,longer_alt:te,categories:P}),Pe=o({name:"BuiltinFunctions",pattern:/SIN|ASIN|COS|ACOS|TAN|ATAN|SQRT|ABS|BIN|BCD|ROUND|FIX|FUP|LN|EXP/,longer_alt:d}),jt=o({name:"WhiteSpace",pattern:/[\s\t\r]+/,group:K.SKIPPED}),q=o({name:"Comment",pattern:/\(\s*(.+?)\s*\)/,start_chars_hint:["("]}),ye=o({name:"GotoLine",pattern:/GOTO[1-9][0-9]*/,longer_alt:d,categories:A}),Ie=o({name:"If",pattern:/IF/,longer_alt:d,categories:A}),Be=o({name:"Then",pattern:/THEN/,longer_alt:d,categories:A}),qt=o({name:"Do",pattern:/DO/,longer_alt:d,categories:A}),Ht=o({name:"While",pattern:/WHILE/,longer_alt:d,categories:A}),ke=o({name:"Plus",pattern:"+",categories:G}),H=o({name:"Minus",pattern:"-",categories:G}),Yt=o({name:"Divide",pattern:"/",categories:D}),Ve=o({name:"Product",pattern:"*",categories:D}),Ge=o({name:"Var",pattern:"#"}),De=o({name:"Equals",pattern:"="}),Y=o({name:"Percent",pattern:"%"});o({name:"Dot",pattern:"."});const Zt=o({name:"Comma",pattern:","}),w=o({name:"Newline",pattern:`
`}),Z=[w,jt,Y,q,Bt,kt,Dt,Ft,Vt,Gt,Ie,qt,Be,Ht,ye,Pe,Ge,De,Zt,Yt,Ve,H,ke,Se,Ue,Re,we,d,Xt,te,$t,Wt,k,V,A,ee,P,N,G,D];class Fe extends st{constructor(){super(Z);this.program=this.RULE("program",()=>{this.SUBRULE(this.StartOfFile),this.SUBRULE(this.ProgramNumberLine),this.SUBRULE(this.lines),this.SUBRULE(this.EndOfFile)}),this.lines=this.RULE("lines",()=>{this.MANY_SEP({SEP:w,DEF:()=>this.SUBRULE(this.Line)})}),this.Line=this.RULE("Line",()=>{this.MANY(()=>{this.OR([{ALT:()=>this.CONSUME(Re)},{ALT:()=>this.CONSUME(Se)},{ALT:()=>this.CONSUME(Ue)},{ALT:()=>this.SUBRULE(this.AddressedValue)},{ALT:()=>this.SUBRULE(this.variableAssignment)},{ALT:()=>this.SUBRULE(this.conditionalExpression)},{ALT:()=>this.CONSUME(q)}])})}),this.AddressedValue=this.RULE("AddressedValue",()=>{this.CONSUME(d),this.OPTION(()=>{this.CONSUME(H)}),this.OR([{ALT:()=>this.CONSUME(P)},{ALT:()=>this.SUBRULE(this.VariableLiteral)},{ALT:()=>this.SUBRULE(this.bracketExpression)}])}),this.NumericLiteral=this.RULE("NumericLiteral",()=>{this.OPTION(()=>{this.CONSUME(H)}),this.CONSUME(P)}),this.VariableLiteral=this.RULE("VariableLiteral",()=>{this.CONSUME(Ge),this.CONSUME(te)}),this.ValueLiteral=this.RULE("ValueLiteral",()=>{this.OR([{ALT:()=>this.SUBRULE(this.VariableLiteral)},{ALT:()=>this.SUBRULE(this.NumericLiteral)}])}),this.ProgramNumberLine=this.RULE("ProgramNumberLine",()=>{this.CONSUME(we),this.CONSUME(q),this.CONSUME(w)}),this.expression=this.RULE("expression",()=>{this.SUBRULE(this.additionExpression)}),this.additionExpression=this.RULE("additionExpression",()=>{this.SUBRULE(this.multiplicationExpression,{LABEL:"lhs"}),this.MANY(()=>{this.CONSUME(G),this.SUBRULE2(this.multiplicationExpression,{LABEL:"rhs"})})}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{this.SUBRULE(this.atomicExpression,{LABEL:"lhs"}),this.MANY(()=>{this.CONSUME(D),this.SUBRULE2(this.atomicExpression,{LABEL:"rhs"})})}),this.functionExpression=this.RULE("functionExpression",()=>{this.CONSUME(Pe),this.CONSUME(k),this.SUBRULE(this.atomicExpression),this.CONSUME(V)}),this.booleanExpression=this.RULE("booleanExpression",()=>{this.SUBRULE(this.atomicExpression),this.CONSUME(N),this.SUBRULE2(this.atomicExpression)}),this.conditionalExpression=this.RULE("conditionalExpression",()=>{this.CONSUME(Ie),this.CONSUME(k),this.SUBRULE(this.booleanExpression),this.CONSUME(V),this.OR([{ALT:()=>this.CONSUME(Be)},{ALT:()=>this.CONSUME(ye)}])}),this.atomicExpression=this.RULE("atomicExpression",()=>{this.OR([{ALT:()=>this.SUBRULE(this.bracketExpression)},{ALT:()=>this.SUBRULE(this.functionExpression)},{ALT:()=>this.SUBRULE(this.NumericLiteral)},{ALT:()=>this.SUBRULE(this.VariableLiteral)}])}),this.bracketExpression=this.RULE("bracketExpression",()=>{this.CONSUME(k),this.SUBRULE(this.expression),this.CONSUME(V)}),this.variableAssignment=this.RULE("variableAssignment",()=>{this.SUBRULE(this.VariableLiteral),this.CONSUME(De),this.SUBRULE(this.expression)}),this.StartOfFile=this.RULE("StartOfFile",()=>{this.CONSUME(Y),this.CONSUME(w)}),this.EndOfFile=this.RULE("EndOfFile",()=>{this.CONSUME(Y),this.OPTION(()=>{this.CONSUME(w)})}),_t("initializing"),this.performSelfAnalysis()}}const Kt=new Fe;class Qt{get prefix(){return this._address}get image(){return`${this._address}${this.value}`}constructor(e){if(this.value=NaN,this._address=p(e.Address),this._isNegative=Boolean(e==null?void 0:e.Minus),e!=null&&e.NumericValue){const r=this._isNegative?"-":"";this.value=Ce(`${r}${p(e.NumericValue)}`)}return this}}const Jt=Kt.getBaseCstVisitorConstructorWithDefaults();class er extends Jt{constructor(e){super();var r;this.events=new _e,this._insights=new Ct,m("initializing"),this._mem=(r=e==null?void 0:e.memory)!=null?r:new J,this.validateVisitor()}get Memory(){return this._mem}set Memory(e){this._mem=e}get Insights(){return this._insights}program(e){const r=this.ProgramNumberLine(e.ProgramNumberLine[0].children),s=this.lines(e.lines[0].children);return U(O({},r),{lines:s})}lines(e){const r=[];if(e.Line)for(const s of e.Line){const i=this.visit(s);r.push(i)}return r}ProgramNumberLine(e){const r=g(e.ProgramNumber),s=e!=null&&e.Comment?p(e.Comment):"";return{programTitle:ge(s),programNumber:parseInt(r.payload)}}Line(e){const r={N:NaN,gCodes:[],mCodes:[],comments:[],addresses:[],gCodeMap:{},mCodeMap:{},addressMap:{}};if(e!=null&&e.LineNumber){const s=p(e.LineNumber);m(s),r.N=parseInt(At(s))}if(e!=null&&e.G_Code&&e.G_Code.forEach(s=>{m(p(s)),r.gCodes.push(s),r.gCodeMap[s.image]=!0}),e!=null&&e.M_Code&&e.M_Code.forEach(s=>{m(p(s)),r.mCodes.push(s),r.mCodeMap[s.image]=!0}),e!=null&&e.variableAssignment){const{children:s}=g(e.variableAssignment);this.variableAssignment(s)}if(e!=null&&e.AddressedValue&&e.AddressedValue.forEach(({children:s})=>{const i=this.AddressedValue(s,r.gCodeMap);m(i),r.addresses.push(i),r.addressMap[i.prefix]=i.value}),e!=null&&e.Comment)for(const s of e.Comment){const i=p(s);m(i),r.comments.push(ge(i))}if("G10"in r.gCodeMap){const{addressMap:s}=r;this._mem.g10({L:s.L,P:s.P,R:s.R,X:s.X,Y:s.Y,Z:s.Z,B:s.B})}return r}AddressedValue(e,r={}){const s=new Qt(e),i=new Tt(s);return!St(r)&&!Ae(r)&&this._insights.collect(i),s}NumericLiteral(e){const r=p(e.NumericValue),s=e.Minus?"-":"";return Ce(`${s}${r}`)}VariableLiteral(e){var i;const r=parseInt(p(e.Integer));return{register:r,value:(i=this._mem.read(r))!=null?i:NaN}}ValueLiteral(e){let r=NaN;if(e.VariableLiteral){const{children:s}=g(e.VariableLiteral);r=this.VariableLiteral(s).value}if(e.NumericLiteral){const{children:s}=g(e.NumericLiteral);r=this.NumericLiteral(s)}return r}variableAssignment(e){const r=g(e.VariableLiteral).children,s=this.VariableLiteral(r);s.register,s.value;const i=g(e.expression).children,a=this.expression(i);this._mem.write(s.register,a)}expression(e){const{children:r}=g(e.additionExpression);return this.additionExpression(r)}functionExpression(e){const{children:r}=g(e.atomicExpression),s=p(e.BuiltinFunctions),i=this.atomicExpression(r);return b.match(s).with("LN",()=>Math.log(i)).with("ABS",()=>Math.abs(i)).with("FUP",()=>Math.ceil(i)).with("SQRT",()=>Math.sqrt(i)).with("FIX",()=>Math.floor(i)).with("ROUND",()=>Math.round(i)).with("SIN",()=>Math.sin(z(i))).with("COS",()=>Math.cos(z(i))).with("TAN",()=>Math.tan(z(i))).with("ASIN",()=>X(Math.asin(i))).with("ACOS",()=>X(Math.acos(i))).with("ATAN",()=>X(Math.atan(i))).otherwise(()=>NaN)}additionExpression(e){let r=this.visit(e.lhs);return e.rhs&&e.rhs.forEach((s,i)=>{const a=this.visit(s);if(e!=null&&e.AdditionOperator){const u=e.AdditionOperator[i];he(u,ke)?(m(r,"+",a),r+=a):(m(r,"-",a),r-=a)}}),r}multiplicationExpression(e){let r=this.visit(e.lhs);return e.rhs&&e.rhs.forEach((s,i)=>{const a=this.visit(s);if(e!=null&&e.MultiplicationOperator){const u=e.MultiplicationOperator[i];he(u,Ve)?(m(r,"*",a),r*=a):(m(r,"/",a),r/=a)}}),r}atomicExpression(e){return e.bracketExpression?this.bracketExpression(e.bracketExpression[0].children):e.NumericLiteral?this.NumericLiteral(e.NumericLiteral[0].children):e.functionExpression?this.functionExpression(e.functionExpression[0].children):e.VariableLiteral?this.VariableLiteral(e.VariableLiteral[0].children).value:NaN}bracketExpression(e){const{children:r}=g(e.expression);return this.expression(r)}}class $e extends K{constructor(){xt(`initializing lexer with ${Z.length} tokens`);super(Z)}}new $e;class We{get Lexer(){return this._lexer}get Parser(){return this._parser}get Interpreter(){return this._interpreter}get Memory(){return this._interpreter.Memory}constructor(){bt("initializing"),this._mem=new J,this._lexer=new $e,this._parser=new Fe,this._interpreter=new er({memory:this._mem})}}class tr{constructor(){this._activeProgram=NaN,this._lexerErrors=[],this._programs={},this._events=new _e,me("initializing"),this._env=new We}get Lexer(){return this._env.Lexer}get LexerErrors(){return this._lexerErrors}get Parser(){return this._env.Parser}get ParserErrors(){return this._env.Parser.errors}get Interpreter(){return this._env.Interpreter}get Memory(){return this._env.Memory}get Insights(){return this._env.Interpreter.Insights}run(){const e=new Date;this._tokenizeActiveProgram();const r=this.Parser.program();this.Parser.errors.length>0&&this._events.emit("error",this.Parser.errors);const s=this.Interpreter.program(r.children);return{beginExec:e,result:s}}reset(){this.Memory.reset(),this.Parser.input=[],this._activeProgram=NaN}getErrors(){return{parseErrors:this.ParserErrors,lexingErrors:this.LexerErrors}}onError(e){this._events.on("error",e)}loadParser(e){const{errors:r,tokens:s}=this.Lexer.tokenize(e);return r.length>0?{input:e,errors:r,tokens:[]}:(this.Parser.input=s,{input:e,tokens:s,errors:[]})}evalProgram(e){this._tokenizeForParsing(e);const r=this.Parser.program();return this.Interpreter.program(r.children)}evalLines(e){this._tokenizeForParsing(e);const r=this.Parser.lines();return this.Interpreter.lines(r.children)}getProgram(e){if(typeof e=="string")if(e.startsWith("O")){const r=e.replace(/^O/,"");return this._programs[parseInt(r)]}else return this._programs[parseInt(e)];else return this._programs[e]}getPrograms(){return this._programs}getProgramCount(){return Object.keys(this._programs).length}getActiveProgram(){return typeof this._activeProgram=="number"?this.getProgram(this._activeProgram):"No active program selected."}getActiveProgramNumber(){return this._activeProgram}setActiveProgram(e){me(`Setting program #${e} active`),this._activeProgram=e}loadProgram(e,r){Ut(e,{NOMATCH:s=>this._emitError(s),MATCH:s=>{const i=parseInt(s[1]);return this._programs[i]=e,r!=null&&r.setActive&&(this.setActiveProgram(i),this._tokenizeActiveProgram()),this._programs[i]}})}loadPrograms(e){e.forEach(r=>this.loadProgram(r))}_emitError(e){return this._events.emit("error",e),!1}_tokenizeActiveProgram(){const e=this.getActiveProgram();this._tokenizeForParsing(e)}_tokenizeForParsing(e){const{errors:r,tokens:s}=this.Lexer.tokenize(e);r.length>0&&(this._lexerErrors.push(...r),this._events.emit("error",this._lexerErrors)),this.Parser.input=s}_parseProgramNumber(e){if(typeof e=="string")if(e.startsWith("O")){const r=e.replace(/^O/,"");return parseInt(r)}else return parseInt(e);else return e}}Ot();function rr(){const t=new tr;return h.exports.useState(t)}function be(){return["( VARIABLE ASSIGNMENTS )","#1=3.141592654","","( ALGEBRA )","#2=[1+2]*3","","( VARIABLE SUBSTITUTIONS )","#3=#2/#1","#4=[4*#2]-3","#5=[6+#3+#2]/[#4-#2]","","( BUILT-IN FUNCTIONS )","#6=ABS[-2.3512]","#7=SQRT[49]","#8=ROUND[#1]","#9=FUP[#1]","","( EVAL G10 LINES) ","G10 G90 L2 P1 X1.2345 Y9.8765 Z-8.6753 B270.","G10 G90 L2 P2 X4.6234 Y3.8245 Z-7.2204 B90.","","( ... AND MORE! ) ",""].join(`
`)}function sr(){const t=h.exports.useRef(),[e,r]=Lt("gcode-dark"),[s,i]=h.exports.useState({minimap:{enabled:!1}}),[a]=rr(),{Memory:u}=a,[ze,Xe]=h.exports.useState([]),[M,ir]=h.exports.useState(20),[f,re]=h.exports.useState(1),[je,se]=h.exports.useState([]),[qe,ie]=h.exports.useState([]),[ne,nr]=h.exports.useState([]),[S,He]=h.exports.useState("offsets");function y(c){He(c)}a.onError(c=>{console.log(c)});function Ye(){re(f-1===0?1:f-1)}function Ze(){re(f+1)}function Ke(){const c=u.toArray({includeUnset:!0});if(f===1){const L=M*(f-1),v=L+M,F=c.slice(L,v),$=c.slice(v,v+13);se(F),ie($)}else{const L=33+M*(f-2),v=L+M,F=c.slice(L,v),$=c.slice(v,v+M);se(F),ie($)}}function oe(c){const L=a.evalLines(c);Xe(L)}h.exports.useEffect(()=>{Ke()},[f,ze,a.Memory]);const Qe=c=>{oe(String(c))},Je=c=>{t.current=c,oe(be())};return l("div",{className:"flex flex-col h-screen overflow-y-hidden bg-neutral-800",children:[l("div",{className:"flex flex-row font-bold text-purple-200 bg-violet-900",children:[n("div",{className:"flex-grow",children:n("h1",{className:"py-2 pl-4 text-2xl",children:"Fanuc Macro B Playground"})}),n("div",{children:n("button",{onClick:()=>y("macros"),className:`w-32 h-12 py-2 text-white ${S==="macros"?"bg-neutral-800 rounded-tr-md rounded-tl-md":"bg-violet-900"}`,children:"Macros"})}),n("div",{children:n("button",{onClick:()=>y("offsets"),className:`w-32 h-12 py-2 text-white ${S==="offsets"?"bg-neutral-800 rounded-tr-md rounded-tl-md":"bg-violet-900"}`,children:"Offsets"})}),n("div",{children:n("button",{onClick:()=>y("tools"),className:`w-32 h-12 py-2 text-white ${S==="tools"?"bg-neutral-800 rounded-tr-md rounded-tl-md":"bg-violet-900"}`,children:"Tools"})}),n("div",{children:n("button",{onClick:()=>y("debug"),className:`w-32 h-12 py-2 text-white ${S==="debug"?"bg-neutral-800 rounded-tr-md rounded-tl-md":"bg-violet-900"}`,children:"Debug"})})]}),l("div",{className:"flex flex-row flex-grow",children:[l("div",{className:"flex flex-col w-1/2 border-r border-r-purple-600",children:[l("p",{className:"px-6 py-3 text-sm italic border-b border-b-gray-900 text-violet-100",style:{backgroundColor:"#1E1E1E"},children:["\xBB"," Try editing some of the values!"]}),n(it,{theme:e,defaultLanguage:"gcode",options:s,defaultValue:be(),onChange:Qe,onMount:Je,beforeMount:Nt}),ne.length>0?l("div",{className:"px-4 py-2 bg-neutral-800",children:[n(ct,{errors:ne})," "]}):void 0]}),n("div",{className:"flex flex-col flex-grow bg-neutral-800 ",children:b.match(S).with("offsets",()=>n(ht,{memory:u})).with("debug",()=>l("div",{className:"container",children:[n("h1",{className:"px-2 py-3 text-3xl border-b shadow-neutral-800 bg-neutral-800 border-b-violet-600 text-violet-500",children:"Debug"}),n("div",{className:"p-2 text-blue-400",children:JSON.stringify(u.toObject(),null,"  ")})]})).with("macros",()=>l("div",{className:"container",children:[n("h1",{className:"px-2 py-3 text-3xl border-b shadow-neutral-800 bg-neutral-800 border-b-violet-600 text-violet-500",children:"Macro Variables"}),l("div",{className:"grid grid-flow-row grid-cols-2",children:[n("div",{className:"",children:n(de,{macros:je})}),n("div",{className:"",children:n(de,{macros:qe})})]}),l("div",{className:"flex flex-row justify-center py-4",children:[n("div",{className:"",children:n("button",{onClick:Ye,disabled:f===1,className:"w-32 py-2 text-white border-2 rounded-lg border-violet-600 bg-violet-700 disabled:text-gray-400 disabled:border-gray-600 disabled:bg-gray-500",children:"\xAB Page"})}),l("div",{className:"px-8 py-2 text-white",children:["Page ",n("span",{className:"text-violet-300",children:f})]}),n("div",{className:"",children:n("button",{onClick:Ze,className:"w-32 py-2 text-white border-2 rounded-lg border-violet-600 bg-violet-700",children:"Page \xBB"})})]})]})).otherwise(()=>n(nt,{children:"ERROR"}))})]}),n("div",{className:"flex flex-row content-center text-purple-100 border-t border-t-purple-600 bg-violet-900",children:l("div",{className:"p-2 text-sm",children:["Made By"," ",n("a",{className:"text-purple-300 text-bold hover:text-white",href:"https://github.com/kevinkhill",children:"Kevin Hill"})," ","\xA9 2022"]})})]})}ot.render(n(at.StrictMode,{children:n(sr,{})}),document.getElementById("root"));
