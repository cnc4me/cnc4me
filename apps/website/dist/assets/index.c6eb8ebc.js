var tt=Object.defineProperty,rt=Object.defineProperties;var st=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var ce=(t,e,r)=>e in t?tt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_=(t,e)=>{for(var r in e||(e={}))he.call(e,r)&&ce(t,r,e[r]);if(F)for(var r of F(e))de.call(e,r)&&ce(t,r,e[r]);return t},I=(t,e)=>rt(t,st(e));var Z=(t,e)=>{var r={};for(var s in t)he.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&F)for(var s of F(t))e.indexOf(s)<0&&de.call(t,s)&&(r[s]=t[s]);return r};import{r as d,j as n,i as it,a as o,l as G,D as nt,b as C,c as l,L as ne,C as ot,e as Se,t as ue,u as at,d as lt,F as me,R as ct,B as ht,f as dt}from"./vendor.ac0a8108.js";const ut=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}};ut();function mt(t){return{registerCustomLanguage(e,r){return ft(t,e,r)},registerCustomTheme(e,r){return pt(t,e,r)}}}function gt(t,e){return{brackets:t,tokenizer:{root:e}}}function we(t,e={base:"vs",inherit:!1}){return _(_({},e),t)}function pt(t,e,r){return t.editor.defineTheme(e,r),t}function ft(t,e,r){return t.languages.register({id:e}),t.languages.setMonarchTokensProvider(e,r),t}const Et=gt([["[","]","delimeter.bracket"]],[[/#\d/,"macro-var"],[/\(.+\)/,"comment"],[/G[0-9]+/,"keyword"],[/[\=\+\-\*\/]/,"operators"],[/(\d+(?:\.\d+)?)/,"number"]]),Nt=we({rules:[{token:"comment",foreground:"#C09D70",fontStyle:"italic"}],colors:{}},{base:"vs-dark",inherit:!0}),Lt=we({rules:[{token:"custom-info",foreground:"808080"},{token:"custom-error",foreground:"ff0000",fontStyle:"bold"},{token:"custom-notice",foreground:"FFA500"},{token:"custom-date",foreground:"008800"}],colors:{"editor.foreground":"#000000"}},{base:"vs",inherit:!1}),ge={minimap:{enabled:!1}},vt=({onMount:t,onChange:e,options:r=ge,contents:s="",theme:i="gcode-dark"})=>{function a(f){const{registerCustomLanguage:m,registerCustomTheme:E}=mt(f);return f.languages.typescript.javascriptDefaults.setEagerModelSync(!0),m("gcode",Et),E("gcode-dark",Nt),E("gcode-light",Lt),f}const[h]=d.exports.useState(r!=null?r:ge);return n(it,{theme:i,defaultLanguage:"gcode",options:h,defaultValue:s,onMount:t,onChange:e,beforeMount:a})},K=({href:t,children:e})=>n("a",{className:"text-purple-500 text-bold hover:text-purple-300",href:t,children:e}),xt=()=>o("div",{className:"flex flex-row text-purple-100 bg-neutral-900",children:[o("div",{className:"p-2 text-sm",children:["View ",n(K,{href:"https://github.com/cnc4me/cnc4me/tree/main/packages/fanuc-macro-b",children:"on Github"})]}),o("div",{className:"flex-grow text-center p-2 text-sm",children:[n(K,{href:"https://github.com/cnc4me/cnc4me",children:"CNC 4 ME"})," \xA9 2022"]}),o("div",{className:"p-2 text-sm",children:["Made By ",n(K,{href:"https://github.com/kevinkhill",children:"Kevin Hill"})]})]}),Ot=({onClick:t,label:e})=>n("button",{onClick:()=>t(),className:"px-3 mr-2 my-1.5 text-white border-1 rounded-md border-violet-600 bg-violet-700",children:e});function bt(t){const[e,r]=d.exports.useState(t);return[e,{setEditorThemeDark:()=>r("gcode-dark"),setEditorThemeLight:()=>r("gcode-light")}]}function Tt(){return["( VARIABLE ASSIGNMENTS )","#1=3.141592654","","( ALGEBRA )","#2=[1+2]*3","","( VARIABLE SUBSTITUTIONS )","#3=#2/#1","#4=[4*#2]-3","#5=[6+#3+#2]/[#4-#2]","","( BUILT-IN FUNCTIONS )","#6=ABS[-2.3512]","#7=SQRT[49]","#8=ROUND[#1]","#9=FUP[#1]","","( EVAL G10 LINES FOR WORK OFFSETS ) ","G10 G90 L2 P1 X1.2345 Y9.8765 Z-8.6753 B270.","G10 G90 L2 P2 X4.6234 Y3.8245 Z-7.2204 B90.","","( OR FOR TOOL OFFSETS) ","G10 G90 L11 P1 R3.1235","G10 G90 L10 P1 R.5","G10 G90 L13 P1 R-.0025","G10 G90 L12 P1 R-.001","G10 G90 L11 P2 R5.3162","G10 G90 L10 P2 R.375","G10 G90 L13 P2 R.0012","G10 G90 L12 P2 R3.1235","G10 G90 L11 P3 R2.3903","G10 G90 L10 P3 R1.","G10 G90 L13 P3 R.375","G10 G90 L12 P3 R.004","","( AND MORE! ) ",""].join(`
`)}class _t{constructor(e){this.value=e.value,this.ctx=e.prefix}}class Ct{constructor(){this._entries={}}collect(e){const r=this._entries[e.ctx];return Array.isArray(r)||(this._entries[e.ctx]=[]),this._entries[e.ctx].push(e),this.get(e.ctx).length}get(e){var r;return(r=this._entries[e])!=null?r:[]}values(e){return G.exports.map(this.get(e),"value")}uniqValues(e){return G.exports.uniq(this.values(e))}min(e){var r;return(r=G.exports.min(this.values(e)))!=null?r:NaN}max(e){var r;return(r=G.exports.max(this.values(e)))!=null?r:NaN}}const At=nt("macro"),S=t=>At.extend(t),Rt=S("env"),St=S("lexer"),wt=S("parser"),R=S("memory"),pe=S("runtime"),N=S("interpreter");function L(t){return Array.isArray(t)?t[0]:t}function fe(t){return t.replace(/^\(/,"").replace(/\)$/,"").trim()}function v(t){return L(t).image}function Mt(t){return t.replace(/^[A-Z]/,"")}function Me(t){return t.includes(".")?parseFloat(t):parseInt(t)}function A(t,e){e=e+1;const r=(e-t)/1;return Array.from({length:r},(s,i)=>t+i)}function Q(t){return t*Math.PI/180}function J(t){return 180/Math.PI*t}function Pt(t){const e=[],r=new qe;if(t!=null&&t.preloadInput){const{errors:s,tokens:i}=r.Lexer.tokenize(t.preloadInput);s&&s.push(...s),r.Parser.input=i}return{errors:e,lexer:r.Lexer,parser:r.Parser,interpreter:r.Interpreter}}function Ut(t){return"G4"in t}function Pe(t){return"G10"in t}function It(t,{MATCH:e,NOMATCH:r}){const s=t.match(/^O([0-9]+)\s+?(?:\(.+?\))?$/m);return s===null?r("Program Number Not Found"):e(s)}const Ee=20,Ue={X:1,Y:2,Z:3,B:4};function Ne(t,e){if(t<10||t>13)throw Error("Invalid tool group value.");return t*1e3+e}function Le(t,e){if(t<0||t>6)throw Error(`Cannot compose a register from input: ${t}`);return{0:5200,1:5220,2:5240,3:5260,4:5280,5:5300,6:5320}[t]+Ue[e]}function ve(t,e){const r=t*Ee;return 7e3-Ee+r+Ue[e]}const Gt={LENGTH_COMP:10,LENGTH:11,DIAMETER_COMP:12,DIAMETER:13},yt={COMMON:2,AUX:20},O={TOOL:Gt,WORK:yt};function Bt(t){const{addresses:e,gCodeMap:r}=t;if(!Pe(r))throw Error("G10 not found.");return e.reduce((s,i)=>I(_({},s),{[i.prefix]:i.value}),{})}function kt(t){const{errors:e,parser:r,interpreter:s}=Pt({preloadInput:t});if(e.length>0)return{error:e[0].message,result:null};const i=r.lines(),a=s.lines(i.children);return{error:null,result:Bt(a[0])}}const Vt=4003,{WORK:xe,TOOL:W}=O;function Oe(t){return G.exports.pick(t,["X","Y","Z","B"])}const ee=class{constructor(){this._vars={},this.write(Vt,90),this.reset()}read(t){const e=this._read(t);return R(`[READ ] #${t}= ${e}`),e}readBlocks(t,e){return A(t,t+e).map(r=>this.read(r))}write(t,e){R(`[WRITE] #${t}= ${e}`);const r=this._read(t);return this._write(t,e),{prev:r,curr:this._vars[t]}}clear(t){this._write(t,NaN)}reset(){ee.REGISTERS.forEach(t=>this.clear(t)),R(`Initialized ${ee.REGISTERS.length} registers`)}g10(t){return R("[ G10 ]",t),C.match(t).with({L:xe.COMMON},s=>{var i=s,{P:e}=i,r=Z(i,["P"]);this.setCommonWorkOffset(e,Oe(r))}).with({L:xe.AUX},s=>{var i=s,{P:e}=i,r=Z(i,["P"]);this.setAuxWorkOffset(e,Oe(r))}).with({L:W.LENGTH_COMP,R:C.__.number},({P:e,R:r})=>{this.setToolLengthComp(e,r)}).with({L:W.LENGTH,R:C.__.number},({P:e,R:r})=>{this.setToolLength(e,r)}).with({L:W.DIAMETER_COMP,R:C.__.number},({P:e,R:r})=>{this.setToolDiameterComp(e,r)}).with({L:W.DIAMETER,R:C.__.number},({P:e,R:r})=>{this.setToolDiameter(e,r)}).run()}evalG10(t){const{error:e,result:r}=kt(t);if(r)this.g10(r);else throw Error(e)}getAxisLocations(t){if(t<53||t>59)throw Error(`${t} is not a valid Work Coordinate Group`);return this._getCommonWorkOffsetAxisLocations(t)}getWorkCoordinates(t){const{X:e,Y:r,Z:s,B:i}=this.getAxisLocations(t);return[e,r,s,i]}getAuxWorkCoordinates(t){if(t<1||t>299)throw Error(`${t} is not a valid Aux Work Coordinate Group`);return this._getAuxWorkOffsetAxisLocations(t)}getToolOffsets(t){return{length:this.getToolLength(t),diameter:this.getToolDiameter(t),lengthComp:this.getToolLengthComp(t),diameterComp:this.getToolDiameterComp(t)}}getToolOffsetArray(t){const{length:e,diameter:r,lengthComp:s,diameterComp:i}=this.getToolOffsets(t);return[t,e,r,s,i]}setToolLength(t,e){this._setToolOffsetValue(t,O.TOOL.LENGTH,e)}getToolLength(t){return this._getToolOffsetValueByGroup(t,O.TOOL.LENGTH)}setToolLengthComp(t,e){this._setToolOffsetValue(t,O.TOOL.LENGTH_COMP,e)}getToolLengthComp(t){return this._getToolOffsetValueByGroup(t,O.TOOL.LENGTH_COMP)}setToolDiameter(t,e){this._setToolOffsetValue(t,O.TOOL.DIAMETER,e)}getToolDiameter(t){return this._getToolOffsetValueByGroup(t,O.TOOL.DIAMETER)}setToolDiameterComp(t,e){this._setToolOffsetValue(t,O.TOOL.DIAMETER_COMP,e)}getToolDiameterComp(t){return this._getToolOffsetValueByGroup(t,O.TOOL.DIAMETER_COMP)}setCommonWorkOffset(t,e){R("[O-SET]",`G${t+53}=`,e),Object.entries(e).forEach(([r,s])=>{const i=Le(t,r);this.write(i,s)})}setAuxWorkOffset(t,e){R("[O-SET]",`G54.1 P${t}=`,e),Object.entries(e).forEach(([r,s])=>{const i=ve(t,r);this.write(i,s)})}toArray(t){const e=[];return Object.entries(this._vars).forEach(([r,s])=>{const i=s===null||isNaN(s);(s||i&&(t==null?void 0:t.includeUnset))&&e.push([parseInt(r),s])}),e}toObject(t){const e={};for(const[r,s]of this.toArray(t))e[r]=s;return e}serialize(){return JSON.stringify(this._vars)}_write(t,e){this._vars[t]=e}_read(t){var e;return(e=this._vars[t])!=null?e:NaN}_setToolOffsetValue(t,e,r){const s=Ne(e,t);this.write(s,r)}_getToolOffsetValueByGroup(t,e){const r=Ne(e,t);return this.read(r)}_getCommonWorkOffsetAxisLocations(t){return["X","Y","Z","B"].reduce((e,r)=>{const s=Le(t-53,r);return I(_({},e),{[r]:this._vars[s]})},{})}_getAuxWorkOffsetAxisLocations(t){return["X","Y","Z","B"].reduce((e,r)=>{const s=ve(t,r);return I(_({},e),{[r]:this._vars[s]})},{})}_increment(t,e){const r=this._vars[t];return this._vars[t]=r+e,{prev:r,curr:this._vars[t]}}};let oe=ee;oe.REGISTERS=[...A(1,33),...A(100,199),...A(500,9999),...A(3e3,4999),...A(5e3,14e3)];const w=t=>l({name:t,pattern:ne.NA}),ae=w("Brackets"),B=w("NumericValue"),T=w("BooleanOperator"),j=w("AdditionOperator"),M=w("ControlFlowKeyword"),q=w("MultiplicationOperator"),Dt=l({name:"EqualTo",pattern:/EQ/,categories:T}),Ft=l({name:"NotEqualTo",pattern:/NE/,categories:T}),Wt=l({name:"LessThan",pattern:/LT/,categories:T}),$t=l({name:"LessThanOrEq",pattern:/LE/,categories:T}),zt=l({name:"GreaterThan",pattern:/GT/,categories:T}),Ht=l({name:"GreaterThanOrEq",pattern:/GE/,categories:T}),Xt=l({name:"OpenParen",pattern:"("}),jt=l({name:"CloseParen",pattern:")"}),H=l({name:"OpenBracket",pattern:"[",categories:ae}),X=l({name:"CloseBracket",pattern:"]",categories:ae}),be=/[O|:](\d+)/y;function qt(t,e){let r=null;if(be.lastIndex=e,r=be.exec(t),r!==null){const s=r[0];r.payload=parseInt(s.slice(1))}return r}const p=l({name:"Address",pattern:/[A-Z]/}),Ie=l({name:"G_Code",pattern:/G\d+(\.\d+)?/,longer_alt:p}),Ge=l({name:"M_Code",pattern:/M\d+(\.)?/,longer_alt:p}),ye=l({name:"LineNumber",pattern:/N\d+/,longer_alt:p}),Be=l({name:"ProgramNumber",pattern:qt,line_breaks:!0}),le=l({name:"Integer",pattern:/\d+/,categories:B}),Yt=l({name:"Decimal",pattern:/(?=\d*[.])([0-9]+\.?[0-9]*|\.[0-9]+)/,longer_alt:le,categories:B}),ke=l({name:"BuiltinFunctions",pattern:/SIN|ASIN|COS|ACOS|TAN|ATAN|SQRT|ABS|BIN|BCD|ROUND|FIX|FUP|LN|EXP/,longer_alt:p}),Zt=l({name:"WhiteSpace",pattern:/[\s\t\r]+/,group:ne.SKIPPED}),te=l({name:"Comment",pattern:/\(\s*(.+?)\s*\)/,start_chars_hint:["("]}),Ve=l({name:"GotoLine",pattern:/GOTO[1-9][0-9]*/,longer_alt:p,categories:M}),De=l({name:"If",pattern:/IF/,longer_alt:p,categories:M}),Fe=l({name:"Then",pattern:/THEN/,longer_alt:p,categories:M}),Kt=l({name:"Do",pattern:/DO/,longer_alt:p,categories:M}),Qt=l({name:"While",pattern:/WHILE/,longer_alt:p,categories:M}),We=l({name:"Plus",pattern:"+",categories:j}),re=l({name:"Minus",pattern:"-",categories:j}),Jt=l({name:"Divide",pattern:"/",categories:q}),$e=l({name:"Product",pattern:"*",categories:q}),ze=l({name:"Var",pattern:"#"}),He=l({name:"Equals",pattern:"="}),se=l({name:"Percent",pattern:"%"});l({name:"Dot",pattern:"."});const er=l({name:"Comma",pattern:","}),y=l({name:"Newline",pattern:`
`}),ie=[y,Zt,se,te,Dt,Ft,zt,Ht,Wt,$t,De,Kt,Fe,Qt,Ve,ke,ze,He,er,Jt,$e,re,We,Ie,Ge,ye,Be,p,Yt,le,Xt,jt,H,X,M,ae,B,T,j,q];class Xe extends ot{constructor(){super(ie);this.program=this.RULE("program",()=>{this.SUBRULE(this.StartOfFile),this.SUBRULE(this.ProgramNumberLine),this.SUBRULE(this.lines),this.SUBRULE(this.EndOfFile)}),this.lines=this.RULE("lines",()=>{this.MANY_SEP({SEP:y,DEF:()=>this.SUBRULE(this.Line)})}),this.Line=this.RULE("Line",()=>{this.MANY(()=>{this.OR([{ALT:()=>this.CONSUME(ye)},{ALT:()=>this.CONSUME(Ie)},{ALT:()=>this.CONSUME(Ge)},{ALT:()=>this.SUBRULE(this.AddressedValue)},{ALT:()=>this.SUBRULE(this.variableAssignment)},{ALT:()=>this.SUBRULE(this.conditionalExpression)},{ALT:()=>this.CONSUME(te)}])})}),this.AddressedValue=this.RULE("AddressedValue",()=>{this.CONSUME(p),this.OPTION(()=>{this.CONSUME(re)}),this.OR([{ALT:()=>this.CONSUME(B)},{ALT:()=>this.SUBRULE(this.VariableLiteral)},{ALT:()=>this.SUBRULE(this.bracketExpression)}])}),this.NumericLiteral=this.RULE("NumericLiteral",()=>{this.OPTION(()=>{this.CONSUME(re)}),this.CONSUME(B)}),this.VariableLiteral=this.RULE("VariableLiteral",()=>{this.CONSUME(ze),this.CONSUME(le)}),this.ValueLiteral=this.RULE("ValueLiteral",()=>{this.OR([{ALT:()=>this.SUBRULE(this.VariableLiteral)},{ALT:()=>this.SUBRULE(this.NumericLiteral)}])}),this.ProgramNumberLine=this.RULE("ProgramNumberLine",()=>{this.CONSUME(Be),this.CONSUME(te),this.CONSUME(y)}),this.expression=this.RULE("expression",()=>{this.SUBRULE(this.additionExpression)}),this.additionExpression=this.RULE("additionExpression",()=>{this.SUBRULE(this.multiplicationExpression,{LABEL:"lhs"}),this.MANY(()=>{this.CONSUME(j),this.SUBRULE2(this.multiplicationExpression,{LABEL:"rhs"})})}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{this.SUBRULE(this.atomicExpression,{LABEL:"lhs"}),this.MANY(()=>{this.CONSUME(q),this.SUBRULE2(this.atomicExpression,{LABEL:"rhs"})})}),this.functionExpression=this.RULE("functionExpression",()=>{this.CONSUME(ke),this.CONSUME(H),this.SUBRULE(this.atomicExpression),this.CONSUME(X)}),this.booleanExpression=this.RULE("booleanExpression",()=>{this.SUBRULE(this.atomicExpression),this.CONSUME(T),this.SUBRULE2(this.atomicExpression)}),this.conditionalExpression=this.RULE("conditionalExpression",()=>{this.CONSUME(De),this.CONSUME(H),this.SUBRULE(this.booleanExpression),this.CONSUME(X),this.OR([{ALT:()=>this.CONSUME(Fe)},{ALT:()=>this.CONSUME(Ve)}])}),this.atomicExpression=this.RULE("atomicExpression",()=>{this.OR([{ALT:()=>this.SUBRULE(this.bracketExpression)},{ALT:()=>this.SUBRULE(this.functionExpression)},{ALT:()=>this.SUBRULE(this.NumericLiteral)},{ALT:()=>this.SUBRULE(this.VariableLiteral)}])}),this.bracketExpression=this.RULE("bracketExpression",()=>{this.CONSUME(H),this.SUBRULE(this.expression),this.CONSUME(X)}),this.variableAssignment=this.RULE("variableAssignment",()=>{this.SUBRULE(this.VariableLiteral),this.CONSUME(He),this.SUBRULE(this.expression)}),this.StartOfFile=this.RULE("StartOfFile",()=>{this.CONSUME(se),this.CONSUME(y)}),this.EndOfFile=this.RULE("EndOfFile",()=>{this.CONSUME(se),this.OPTION(()=>{this.CONSUME(y)})}),wt("initializing"),this.performSelfAnalysis()}}const tr=new Xe;class rr{get prefix(){return this._address}get image(){return`${this._address}${this.value}`}constructor(e){if(this.value=NaN,this._address=v(e.Address),this._isNegative=Boolean(e==null?void 0:e.Minus),e!=null&&e.NumericValue){const r=this._isNegative?"-":"";this.value=Me(`${r}${v(e.NumericValue)}`)}return this}}const sr=tr.getBaseCstVisitorConstructorWithDefaults();class ir extends sr{constructor(e){super();var r;this.events=new Se,this._insights=new Ct,N("initializing"),this._mem=(r=e==null?void 0:e.memory)!=null?r:new oe,this.validateVisitor()}get Memory(){return this._mem}set Memory(e){this._mem=e}get Insights(){return this._insights}program(e){const r=this.ProgramNumberLine(e.ProgramNumberLine[0].children),s=this.lines(e.lines[0].children);return I(_({},r),{lines:s})}lines(e){const r=[];if(e.Line)for(const s of e.Line){const i=this.visit(s);r.push(i)}return r}ProgramNumberLine(e){const r=L(e.ProgramNumber),s=e!=null&&e.Comment?v(e.Comment):"";return{programTitle:fe(s),programNumber:parseInt(r.payload)}}Line(e){const r={N:NaN,gCodes:[],mCodes:[],comments:[],addresses:[],gCodeMap:{},mCodeMap:{},addressMap:{}};if(e!=null&&e.LineNumber){const s=v(e.LineNumber);N(s),r.N=parseInt(Mt(s))}if(e!=null&&e.G_Code&&e.G_Code.forEach(s=>{N(v(s)),r.gCodes.push(s),r.gCodeMap[s.image]=!0}),e!=null&&e.M_Code&&e.M_Code.forEach(s=>{N(v(s)),r.mCodes.push(s),r.mCodeMap[s.image]=!0}),e!=null&&e.variableAssignment){const{children:s}=L(e.variableAssignment);this.variableAssignment(s)}if(e!=null&&e.AddressedValue&&e.AddressedValue.forEach(({children:s})=>{const i=this.AddressedValue(s,r.gCodeMap);N(i),r.addresses.push(i),r.addressMap[i.prefix]=i.value}),e!=null&&e.Comment)for(const s of e.Comment){const i=v(s);N(i),r.comments.push(fe(i))}if("G10"in r.gCodeMap){const{addressMap:s}=r;this._mem.g10({L:s.L,P:s.P,R:s.R,X:s.X,Y:s.Y,Z:s.Z,B:s.B})}return r}AddressedValue(e,r={}){const s=new rr(e),i=new _t(s);return!Ut(r)&&!Pe(r)&&this._insights.collect(i),s}NumericLiteral(e){const r=v(e.NumericValue),s=e.Minus?"-":"";return Me(`${s}${r}`)}VariableLiteral(e){var i;const r=parseInt(v(e.Integer));return{register:r,value:(i=this._mem.read(r))!=null?i:NaN}}ValueLiteral(e){let r=NaN;if(e.VariableLiteral){const{children:s}=L(e.VariableLiteral);r=this.VariableLiteral(s).value}if(e.NumericLiteral){const{children:s}=L(e.NumericLiteral);r=this.NumericLiteral(s)}return r}variableAssignment(e){const r=L(e.VariableLiteral).children,s=this.VariableLiteral(r);s.register,s.value;const i=L(e.expression).children,a=this.expression(i);this._mem.write(s.register,a)}expression(e){const{children:r}=L(e.additionExpression);return this.additionExpression(r)}functionExpression(e){const{children:r}=L(e.atomicExpression),s=v(e.BuiltinFunctions),i=this.atomicExpression(r);return C.match(s).with("LN",()=>Math.log(i)).with("ABS",()=>Math.abs(i)).with("FUP",()=>Math.ceil(i)).with("SQRT",()=>Math.sqrt(i)).with("FIX",()=>Math.floor(i)).with("ROUND",()=>Math.round(i)).with("SIN",()=>Math.sin(Q(i))).with("COS",()=>Math.cos(Q(i))).with("TAN",()=>Math.tan(Q(i))).with("ASIN",()=>J(Math.asin(i))).with("ACOS",()=>J(Math.acos(i))).with("ATAN",()=>J(Math.atan(i))).otherwise(()=>NaN)}additionExpression(e){let r=this.visit(e.lhs);return e.rhs&&e.rhs.forEach((s,i)=>{const a=this.visit(s);if(e!=null&&e.AdditionOperator){const h=e.AdditionOperator[i];ue(h,We)?(N(r,"+",a),r+=a):(N(r,"-",a),r-=a)}}),r}multiplicationExpression(e){let r=this.visit(e.lhs);return e.rhs&&e.rhs.forEach((s,i)=>{const a=this.visit(s);if(e!=null&&e.MultiplicationOperator){const h=e.MultiplicationOperator[i];ue(h,$e)?(N(r,"*",a),r*=a):(N(r,"/",a),r/=a)}}),r}atomicExpression(e){return e.bracketExpression?this.bracketExpression(e.bracketExpression[0].children):e.NumericLiteral?this.NumericLiteral(e.NumericLiteral[0].children):e.functionExpression?this.functionExpression(e.functionExpression[0].children):e.VariableLiteral?this.VariableLiteral(e.VariableLiteral[0].children).value:NaN}bracketExpression(e){const{children:r}=L(e.expression);return this.expression(r)}}class je extends ne{constructor(){St(`initializing lexer with ${ie.length} tokens`);super(ie)}}new je;class qe{get Lexer(){return this._lexer}get Parser(){return this._parser}get Interpreter(){return this._interpreter}get Memory(){return this._interpreter.Memory}constructor(){Rt("initializing"),this._mem=new oe,this._lexer=new je,this._parser=new Xe,this._interpreter=new ir({memory:this._mem})}}class nr{constructor(){this._activeProgram=NaN,this._lexerErrors=[],this._programs={},this._events=new Se,pe("initializing"),this._env=new qe}get Lexer(){return this._env.Lexer}get LexerErrors(){return this._lexerErrors}get Parser(){return this._env.Parser}get ParserErrors(){return this._env.Parser.errors}get Interpreter(){return this._env.Interpreter}get Memory(){return this._env.Memory}get Insights(){return this._env.Interpreter.Insights}run(){const e=new Date;this._tokenizeActiveProgram();const r=this.Parser.program();this.Parser.errors.length>0&&this._events.emit("error",this.Parser.errors);const s=this.Interpreter.program(r.children);return{beginExec:e,result:s}}reset(){this.Memory.reset(),this.Parser.input=[],this._activeProgram=NaN}getErrors(){return{parseErrors:this.ParserErrors,lexingErrors:this.LexerErrors}}onError(e){this._events.on("error",e)}loadParser(e){const{errors:r,tokens:s}=this.Lexer.tokenize(e);return r.length>0?{input:e,errors:r,tokens:[]}:(this.Parser.input=s,{input:e,tokens:s,errors:[]})}evalProgram(e){this._tokenizeForParsing(e);const r=this.Parser.program();return this.Interpreter.program(r.children)}evalLines(e){this._tokenizeForParsing(e);const r=this.Parser.lines();return this.Interpreter.lines(r.children)}getProgram(e){if(typeof e=="string")if(e.startsWith("O")){const r=e.replace(/^O/,"");return this._programs[parseInt(r)]}else return this._programs[parseInt(e)];else return this._programs[e]}getPrograms(){return this._programs}getProgramCount(){return Object.keys(this._programs).length}getActiveProgram(){return typeof this._activeProgram=="number"?this.getProgram(this._activeProgram):"No active program selected."}getActiveProgramNumber(){return this._activeProgram}setActiveProgram(e){pe(`Setting program #${e} active`),this._activeProgram=e}loadProgram(e,r){It(e,{NOMATCH:s=>this._emitError(s),MATCH:s=>{const i=parseInt(s[1]);return this._programs[i]=e,r!=null&&r.setActive&&(this.setActiveProgram(i),this._tokenizeActiveProgram()),this._programs[i]}})}loadPrograms(e){e.forEach(r=>this.loadProgram(r))}_emitError(e){return this._events.emit("error",e),!1}_tokenizeActiveProgram(){const e=this.getActiveProgram();this._tokenizeForParsing(e)}_tokenizeForParsing(e){const{errors:r,tokens:s}=this.Lexer.tokenize(e);r.length>0&&(this._lexerErrors.push(...r),this._events.emit("error",this._lexerErrors)),this.Parser.input=s}_parseProgramNumber(e){if(typeof e=="string")if(e.startsWith("O")){const r=e.replace(/^O/,"");return parseInt(r)}else return parseInt(e);else return e}}const or=new nr;function ar(){return or}const lr=()=>at().pathname.replace(/^\//,"");function k(t,e=8){return String(t).padStart(e,"0")}function $(t,e=4){return(Math.round(t*1e4)/1e4).toFixed(e)}const cr=({errors:t})=>o("div",{className:"",children:[n("h1",{className:"pb-1 text-xl font-bold text-violet-400",children:"Errors:"}),t.map((e,r)=>{const s=k(r+1,2);return o("div",{className:"flex flex-row font-mono text-xs",children:[o("div",{className:"font-bold text-red-400",children:["E",s,":"]}),n("div",{className:"text-red-600",children:n("pre",{children:JSON.stringify(e,null," ")})})]},s)})]}),V=({value:t})=>n("h1",{className:"pl-3 py-2 text-3xl border-b shadow-neutral-800 bg-neutral-900 border-b-violet-600 text-violet-500",children:t}),hr=({editorContents:t,memory:e,errors:r})=>{const[s,i]=d.exports.useState("");return d.exports.useEffect(()=>{const a=lt.compressToEncodedURIComponent(t);i(a)}),o("div",{className:"container flex flex-col",children:[n(V,{value:"Debug"}),o("div",{className:"flex flex-row",children:[n("div",{className:"p-2 text-blue-400",children:n("pre",{children:JSON.stringify(e.toObject(),null,"  ")})}),n("div",{className:"border-purple-500 border p-2",children:n("div",{className:"font-mono text-purple-500 break-all",children:s})}),n("div",{children:r.length>0?o("div",{className:"px-4 py-2 bg-neutral-800",children:[n(cr,{errors:r})," "]}):void 0})]})]})},dr=()=>o("div",{className:"container flex flex-col",children:[n(V,{value:"Home"}),n("div",{className:"flex flex-row",children:o("div",{className:"pt-5",children:[n("p",{className:"px-10 py-5 text-blue-300",children:"Hello and welcome to the Fanuc Macro B online playground."}),n("p",{className:"px-10 py-5 text-violet-400",children:"This is a virtual environment for executing partial or full programs with evaluation of macro expressions."}),n("p",{className:"px-10 py-5 text-purple-300",children:"It was created with the goal of letting an operator view how a macro program might execute in the machine, without interrupting production."})]})})]}),Te=({onClick:t,label:e})=>n("button",{onClick:()=>t(),className:"w-32 py-2 text-white border-2 rounded-lg border-violet-600 bg-violet-700",children:e}),Ye=({onPageLeft:t,pageCount:e,onPageRight:r})=>o("div",{className:"flex flex-row justify-center py-4",children:[n(Te,{label:n(me,{children:"\xAB Page"}),onClick:()=>t()}),o("div",{className:"px-8 py-2 text-white",children:["Page ",n("span",{className:"text-violet-300",children:e})]}),n(Te,{label:n(me,{children:"Page \xBB"}),onClick:()=>r()})]}),_e=({macros:t})=>o("div",{className:"flex flex-col gap-1 px-4 pt-2 font-mono",children:[o("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]}),t.map(e=>o("div",{className:"flex flex-row",children:[o("div",{className:"w-12 pt-px text-blue-400",children:["#",k(e[0],4)]}),n("div",{className:"flex-grow pl-1 border-t border-l bg-violet-100 border-l-black border-t-black",children:e[1].toFixed(10)})]},e[0]))]}),ur=({memory:t})=>{const[e,r]=d.exports.useState(1),[s,i]=d.exports.useState([]),[a,h]=d.exports.useState([]),f=()=>r(e-1===0?1:e-1),m=()=>r(e+1),E=()=>{const x=t.toArray({includeUnset:!0}),g=20;if(e===1){const b=g*(e-1),u=b+g,P=x.slice(b,u),D=x.slice(u,u+13);i(P),h(D)}else{const b=33+g*(e-2),u=b+g,P=x.slice(b,u),D=x.slice(u,u+g);i(P),h(D)}};return d.exports.useEffect(()=>{E()},[e,t]),o("div",{className:"container h-full flex flex-col",children:[n(V,{value:"Macro Variables"}),o("div",{className:"grid grid-flow-row flex-grow grid-cols-2",children:[n("div",{className:"",children:n(_e,{macros:s})}),n("div",{className:"",children:n(_e,{macros:a})})]}),n("div",{children:n(Ye,{pageCount:e,onPageLeft:f,onPageRight:m})})]})},Ce=({group:t,locations:e})=>o("div",{className:"flex flex-row mb-1",children:[o("div",{className:"flex flex-col",children:[n("div",{className:"text-blue-400",children:k(t-53,3)}),n("div",{className:"text-blue-400",children:t===53?"EXT":`G${t}`})]}),n("div",{className:"flex flex-col flex-grow pr-10",children:Object.entries(e).map(([r,s])=>o("div",{className:"flex flex-row",children:[n("div",{className:"w-12 pt-px pr-3 text-right text-violet-100",children:r}),n("div",{className:"flex-grow pl-1 border-t border-l bg-violet-100 border-l-black border-t-black",children:s})]},r))})]}),mr=({memory:t})=>{const e=[53,54,55,56].map(s=>[s,t.getAxisLocations(s)]),r=[57,58,59].map(s=>[s,t.getAxisLocations(s)]);return o("div",{className:"container",children:[n(V,{value:"Work Coordinates"}),o("div",{className:"flex flex-col",children:[o("div",{className:"grid grid-flow-row grid-cols-2 px-4 pt-2 font-mono",children:[o("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]}),o("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]})]}),o("div",{className:"grid grid-flow-row grid-cols-2 px-4 pt-2 font-mono",children:[n("div",{children:e.map(([s,i])=>n(Ce,{group:s,locations:i},s))}),n("div",{children:r.map(([s,i])=>n(Ce,{group:s,locations:i},s))})]})]})]})},z=4,Ae=24,gr=({memory:t})=>{const[e,r]=d.exports.useState(1),[s,i]=d.exports.useState([]),a=()=>r(e-1===0?1:e-1),h=()=>r(e+1),f=m=>{const x=A(m,m+Ae-1).map(g=>t.getToolOffsetArray(g));i(x)};return d.exports.useEffect(()=>{const m=e-1,E=Ae*m;f(1+E)},[e,t]),o("div",{className:"container h-full flex flex-col",children:[n(V,{value:"Tools"}),o("div",{className:"font-mono flex flex-col flex-grow pt-2",children:[o("div",{className:"flex flex-row justify-around ml-12 mr-4",children:[n("div",{className:"text-blue-400",children:"(LENGTH)"}),n("div",{className:"text-blue-400",children:"(RADIUS)"})]}),o("div",{className:"flex flex-row text-center mr-4",children:[n("div",{className:"flex-shrink text-blue-400 pl-5",children:"NO."}),o("div",{className:"flex flex-row flex-grow",children:[n("div",{className:"flex-grow text-blue-400",children:"GEOM"}),n("div",{className:"flex-grow text-blue-400",children:"WEAR"}),n("div",{className:"flex-grow text-blue-400",children:"GEOM"}),n("div",{className:"flex-grow text-blue-400",children:"WEAR"})]})]}),n("div",{className:"flex flex-col px-4",children:s.map(m=>{const[E,x,g,b,u]=m;return o("div",{className:"flex gap-1",children:[n("div",{className:"flex-shrink text-blue-400",children:k(E,3)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:$(x,z)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:$(g,z)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:$(b,z)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:$(u,z)})]},k(m[0],3))})})]}),n("div",{className:"flex-shrink",children:n(Ye,{onPageLeft:a,onPageRight:h,pageCount:e})})]})},pr="welcome",Re=["welcome","macros","offsets","tools","debug"];function fr(){const t=Tt(),e=ar(),r=lr(),s=Re.includes(r)?r:pr,[i,a]=d.exports.useState(s),h=d.exports.useRef(),f=()=>{var c,U;return(U=(c=h.current)==null?void 0:c.getValue())!=null?U:""},[m,{setEditorThemeDark:E,setEditorThemeLight:x}]=bt("gcode-dark"),[g,b]=d.exports.useState([]),[u,P]=d.exports.useState(e.Memory),[D,Ze]=d.exports.useState([]);e.onError(c=>{console.log(c)});const Y=c=>{const U=e.evalLines(c);Ze(U),P(e.Memory)},Ke=c=>{h.current=c,Y(t)},Qe=c=>{Y(String(c))},Je=()=>{const c=f();c&&Y(String(c))},et=()=>C.match(i).with("welcome",()=>n(dr,{})).with("offsets",()=>n(mr,{memory:u})).with("macros",()=>n(ur,{memory:u})).with("tools",()=>n(gr,{memory:u})).with("debug",()=>n(hr,{editorContents:f(),memory:u,errors:g})).otherwise(()=>n("h1",{className:"p-10 text-red-600",children:"ERROR"}));return o("div",{className:"container-fluid flex flex-col h-screen overflow-y-hidden bg-neutral-800",children:[o("header",{className:"flex flex-row font-bold text-purple-200 bg-violet-900",children:[n("div",{className:"flex-grow",children:n("h1",{className:"py-2 pl-4 text-2xl",children:"Fanuc Macro B Playground"})}),n("div",{children:Re.map(c=>n("button",{onClick:()=>a(c),className:`w-28 h-12 py-2 text-white ${i===c?"bg-neutral-900 rounded-tr-md rounded-tl-md":"bg-violet-900"}`,children:c.toUpperCase()},c))})]}),o("main",{className:"flex flex-row flex-grow",children:[o("section",{className:"flex flex-col w-1/2 border-r border-r-purple-600",children:[o("div",{className:"flex border-b border-b-gray-900 bg-[#1E1E1E]",children:[o("p",{className:"px-6 py-3 text-sm italic text-violet-100",children:["\xBB"," Try editing some of the values!"]}),n("div",{className:"flex-grow"}),n(Ot,{label:"Run \u2BC8",onClick:Je})]}),n(vt,{contents:t,theme:m,onMount:Ke,onChange:Qe})]}),n("aside",{className:"flex-grow min-h-100 bg-neutral-800",children:n(et,{})})]}),n("footer",{className:"border-t border-t-purple-600",children:n(xt,{})})]})}ct.render(n(ht,{children:n(dt.StrictMode,{children:n(fr,{})})}),document.getElementById("root"));
