var Ke=Object.defineProperty,Qe=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var ne=(t,e,r)=>e in t?Ke(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,O=(t,e)=>{for(var r in e||(e={}))oe.call(e,r)&&ne(t,r,e[r]);if(P)for(var r of P(e))ae.call(e,r)&&ne(t,r,e[r]);return t},M=(t,e)=>Qe(t,Je(e));var D=(t,e)=>{var r={};for(var s in t)oe.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&P)for(var s of P(t))e.indexOf(s)<0&&ae.call(t,s)&&(r[s]=t[s]);return r};import{j as l,a as n,r as h,D as Oe,l as S,b as _,c as o,L as H,C as et,e as be,t as le,i as tt,R as rt,d as st}from"./vendor.70f1acf6.js";const it=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const E of a.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&s(E)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}};it();function Y(t,e=8){return String(t).padStart(e,"0")}function nt({errors:t}){return l("div",{className:"",children:[n("h1",{className:"pb-1 text-xl font-bold text-violet-400",children:"Errors:"}),t.map((e,r)=>{const s=Y(r+1,2);return l("div",{className:"flex flex-row font-mono text-xs",children:[l("div",{className:"font-bold text-red-400",children:["E",s,":"]}),n("div",{className:"text-red-600",children:n("pre",{children:JSON.stringify(e,null," ")})})]},s)})]})}const ce=({group:t,locations:e})=>l("div",{className:"flex flex-row mb-1",children:[l("div",{className:"flex flex-col",children:[n("div",{className:"text-blue-400",children:Y(t-53,3)}),n("div",{className:"text-blue-400",children:t===53?"EXT":`G${t}`})]}),n("div",{className:"flex flex-col flex-grow pr-10",children:Object.entries(e).map(([r,s])=>l("div",{className:"flex flex-row",children:[n("div",{className:"w-12 pt-px pr-3 text-right text-violet-100",children:r}),n("div",{className:"flex-grow pl-1 border-t border-l bg-violet-100 border-l-black border-t-black",children:s})]}))})]});function ot({memory:t}){const e=[53,54,55,56].map(s=>[s,t.getAxisLocations(s)]),r=[57,58,59].map(s=>[s,t.getAxisLocations(s)]);return l("div",{className:"container",children:[l("div",{className:"grid grid-flow-row grid-cols-2 px-4 pt-2 font-mono",children:[l("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]}),l("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]})]}),l("div",{className:"grid grid-flow-row grid-cols-2 px-4 pt-2 font-mono",children:[n("div",{children:e.map(([s,i])=>n(ce,{group:s,locations:i}))}),n("div",{children:r.map(([s,i])=>n(ce,{group:s,locations:i}))})]})]})}const at=({memory:t})=>l("div",{className:"container",children:[n("h1",{className:"px-2 py-3 text-3xl shadow-neutral-800 bg-neutral-800 text-violet-500",children:"Macro Registers"}),n("div",{className:"flex flex-col",children:n("div",{className:"pb-4 border-t border-t-purple-600",children:n(ot,{memory:t})})})]}),he=({macros:t})=>l("div",{className:"flex flex-col gap-1 px-4 pt-2 font-mono",children:[l("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]}),t.map(e=>l("div",{className:"flex flex-row",children:[l("div",{className:"w-12 pt-px text-violet-100",children:["#",Y(e[0],4)]}),n("div",{className:"flex-grow pl-1 border-t border-l bg-violet-100 border-l-black border-t-black",children:e[1].toFixed(10)})]},e[0]))]});function lt(t){return{registerCustomLanguage(e,r){return ut(t,e,r)},registerCustomTheme(e,r){return ht(t,e,r)}}}function ct(t,e){return{brackets:t,tokenizer:{root:e}}}function _e(t,e={base:"vs",inherit:!1}){return O(O({},e),t)}function ht(t,e,r){return t.editor.defineTheme(e,r),t}function ut(t,e,r){return t.languages.register({id:e}),t.languages.setMonarchTokensProvider(e,r),t}const dt=ct([["[","]","delimeter.bracket"]],[[/#\d/,"macro-var"],[/\(.+\)/,"comment"],[/[\=\+\-\*\/]/,"operators"],[/(\d+(?:\.\d+)?)/,"number"]]),mt=_e({rules:[{token:"comment",foreground:"#C09D70",fontStyle:"italic"}],colors:{}},{base:"vs-dark",inherit:!0}),gt=_e({rules:[{token:"custom-info",foreground:"808080"},{token:"custom-error",foreground:"ff0000",fontStyle:"bold"},{token:"custom-notice",foreground:"FFA500"},{token:"custom-date",foreground:"008800"}],colors:{"editor.foreground":"#000000"}},{base:"vs",inherit:!1});function pt(t){const{registerCustomLanguage:e,registerCustomTheme:r}=lt(t);return t.languages.typescript.javascriptDefaults.setEagerModelSync(!0),e("gcode",dt),r("gcode-dark",mt),r("gcode-light",gt),t}function ft(t){const[e,r]=h.exports.useState(t);return[e,{setEditorThemeDark:()=>r("gcode-dark"),setEditorThemeLight:()=>r("gcode-light")}]}const Et=Oe("macro"),T=t=>Et.extend(t),Lt=t=>Oe.enable(t!=null?t:"macro:*"),Nt=T("env"),vt=T("lexer"),Ot=T("parser"),b=T("memory"),ue=T("runtime"),d=T("interpreter");class bt{constructor(e){this.value=e.value,this.ctx=e.prefix}}class _t{constructor(){this._entries={}}collect(e){const r=this._entries[e.ctx];return Array.isArray(r)||(this._entries[e.ctx]=[]),this._entries[e.ctx].push(e),this.get(e.ctx).length}get(e){var r;return(r=this._entries[e])!=null?r:[]}values(e){return S.exports.map(this.get(e),"value")}uniqValues(e){return S.exports.uniq(this.values(e))}min(e){var r;return(r=S.exports.min(this.values(e)))!=null?r:NaN}max(e){var r;return(r=S.exports.max(this.values(e)))!=null?r:NaN}}function m(t){return Array.isArray(t)?t[0]:t}function de(t){return t.replace(/^\(/,"").replace(/\)$/,"").trim()}function g(t){return m(t).image}function xt(t){return t.replace(/^[A-Z]/,"")}function xe(t){return t.includes(".")?parseFloat(t):parseInt(t)}function x(t,e){e=e+1;const r=(e-t)/1;return Array.from({length:r},(s,i)=>t+i)}function F(t){return t*Math.PI/180}function W(t){return 180/Math.PI*t}function Tt(t){const e=[],r=new Fe;if(t!=null&&t.preloadInput){const{errors:s,tokens:i}=r.Lexer.tokenize(t.preloadInput);s&&s.push(...s),r.Parser.input=i}return{errors:e,lexer:r.Lexer,parser:r.Parser,interpreter:r.Interpreter}}function At(t){return"G4"in t}function Te(t){return"G10"in t}function Ct(t,{MATCH:e,NOMATCH:r}){const s=t.match(/^O([0-9]+)\s+?(?:\(.+?\))?$/m);return s===null?r("Program Number Not Found"):e(s)}const me=20,Ae={X:1,Y:2,Z:3,B:4};function ge(t,e){if(t<10||t>13)throw Error("Invalid tool group value.");return t*1e3+e}function pe(t,e){if(t<0||t>6)throw Error(`Cannot compose a register from input: ${t}`);return{0:5200,1:5220,2:5240,3:5260,4:5280,5:5300,6:5320}[t]+Ae[e]}function fe(t,e){const r=t*me;return 7e3-me+r+Ae[e]}const Mt={LENGTH_COMP:10,LENGTH:11,DIAMETER_COMP:12,DIAMETER:13},St={COMMON:2,AUX:20},f={TOOL:Mt,WORK:St};function Ut(t){const{addresses:e,gCodeMap:r}=t;if(!Te(r))throw Error("G10 not found.");return e.reduce((s,i)=>M(O({},s),{[i.prefix]:i.value}),{})}function Rt(t){const{errors:e,parser:r,interpreter:s}=Tt({preloadInput:t});if(e.length>0)return{error:e[0].message,result:null};const i=r.lines(),a=s.lines(i.children);return{error:null,result:Ut(a[0])}}const Pt=4003,{WORK:Ee,TOOL:w}=f;function Le(t){return S.exports.pick(t,["X","Y","Z","B"])}const $=class{constructor(){this._vars={},this.write(Pt,90),this.reset()}read(t){const e=this._read(t);return b(`[READ ] #${t}= ${e}`),e}readBlocks(t,e){return x(t,t+e).map(r=>this.read(r))}write(t,e){b(`[WRITE] #${t}= ${e}`);const r=this._read(t);return this._write(t,e),{prev:r,curr:this._vars[t]}}clear(t){this._write(t,NaN)}reset(){$.REGISTERS.forEach(t=>this.clear(t)),b(`Initialized ${$.REGISTERS.length} registers`)}g10(t){return b("[ G10 ]",t),_.match(t).with({L:Ee.COMMON},s=>{var i=s,{P:e}=i,r=D(i,["P"]);this.setCommonWorkOffset(e,Le(r))}).with({L:Ee.AUX},s=>{var i=s,{P:e}=i,r=D(i,["P"]);this.setAuxWorkOffset(e,Le(r))}).with({L:w.LENGTH_COMP,R:_.__.number},({P:e,R:r})=>{this.setToolLengthComp(e,r)}).with({L:w.LENGTH,R:_.__.number},({P:e,R:r})=>{this.setToolLength(e,r)}).with({L:w.DIAMETER_COMP,R:_.__.number},({P:e,R:r})=>{this.setToolDiameterComp(e,r)}).with({L:w.DIAMETER,R:_.__.number},({P:e,R:r})=>{this.setToolDiameter(e,r)}).run()}evalG10(t){const{error:e,result:r}=Rt(t);if(r)this.g10(r);else throw Error(e)}getAxisLocations(t){if(t<53||t>59)throw Error(`${t} is not a valid Work Coordinate Group`);return this._getCommonWorkOffsetAxisLocations(t)}getWorkCoordinates(t){const{X:e,Y:r,Z:s,B:i}=this.getAxisLocations(t);return[e,r,s,i]}getAuxWorkCoordinates(t){if(t<1||t>299)throw Error(`${t} is not a valid Aux Work Coordinate Group`);return this._getAuxWorkOffsetAxisLocations(t)}getToolOffsets(t){return{length:this.getToolLength(t),diameter:this.getToolDiameter(t),lengthComp:this.getToolLengthComp(t),diameterComp:this.getToolDiameterComp(t)}}setToolLength(t,e){this._setToolOffsetValue(t,f.TOOL.LENGTH,e)}getToolLength(t){return this._getToolOffsetValueByGroup(t,f.TOOL.LENGTH)}setToolLengthComp(t,e){this._setToolOffsetValue(t,f.TOOL.LENGTH_COMP,e)}getToolLengthComp(t){return this._getToolOffsetValueByGroup(t,f.TOOL.LENGTH_COMP)}setToolDiameter(t,e){this._setToolOffsetValue(t,f.TOOL.DIAMETER,e)}getToolDiameter(t){return this._getToolOffsetValueByGroup(t,f.TOOL.DIAMETER)}setToolDiameterComp(t,e){this._setToolOffsetValue(t,f.TOOL.DIAMETER_COMP,e)}getToolDiameterComp(t){return this._getToolOffsetValueByGroup(t,f.TOOL.DIAMETER_COMP)}setCommonWorkOffset(t,e){b("[O-SET]",`G${t+53}=`,e),Object.entries(e).forEach(([r,s])=>{const i=pe(t,r);this.write(i,s)})}setAuxWorkOffset(t,e){b("[O-SET]",`G54.1 P${t}=`,e),Object.entries(e).forEach(([r,s])=>{const i=fe(t,r);this.write(i,s)})}get forEach(){return Object.entries(this._vars)}toArray(t){const e=[];return Object.entries(this._vars).forEach(([r,s])=>{const i=s===null||isNaN(s);(s||i&&(t==null?void 0:t.includeUnset))&&e.push([parseInt(r),s])}),e}toObject(t){const e={};for(const[r,s]of this.toArray(t))e[r]=s;return e}serialize(){return JSON.stringify(this._vars)}_write(t,e){this._vars[t]=e}_read(t){var e;return(e=this._vars[t])!=null?e:NaN}_setToolOffsetValue(t,e,r){const s=ge(e,t);this.write(s,r)}_getToolOffsetValueByGroup(t,e){const r=ge(e,t);return this.read(r)}_getCommonWorkOffsetAxisLocations(t){return["X","Y","Z","B"].reduce((e,r)=>{const s=pe(t-53,r);return M(O({},e),{[r]:this._vars[s]})},{})}_getAuxWorkOffsetAxisLocations(t){return["X","Y","Z","B"].reduce((e,r)=>{const s=fe(t,r);return M(O({},e),{[r]:this._vars[s]})},{})}_increment(t,e){const r=this._vars[t];return this._vars[t]=r+e,{prev:r,curr:this._vars[t]}}};let Z=$;Z.REGISTERS=[...x(1,33),...x(100,199),...x(500,9999),...x(3e3,4999),...x(5e3,14e3)];const A=t=>o({name:t,pattern:H.NA}),K=A("Brackets"),R=A("NumericValue"),L=A("BooleanOperator"),B=A("AdditionOperator"),C=A("ControlFlowKeyword"),k=A("MultiplicationOperator"),wt=o({name:"EqualTo",pattern:/EQ/,categories:L}),yt=o({name:"NotEqualTo",pattern:/NE/,categories:L}),It=o({name:"LessThan",pattern:/LT/,categories:L}),Bt=o({name:"LessThanOrEq",pattern:/LE/,categories:L}),kt=o({name:"GreaterThan",pattern:/GT/,categories:L}),Gt=o({name:"GreaterThanOrEq",pattern:/GE/,categories:L}),Vt=o({name:"OpenParen",pattern:"("}),Dt=o({name:"CloseParen",pattern:")"}),y=o({name:"OpenBracket",pattern:"[",categories:K}),I=o({name:"CloseBracket",pattern:"]",categories:K}),Ne=/[O|:](\d+)/y;function Ft(t,e){let r=null;if(Ne.lastIndex=e,r=Ne.exec(t),r!==null){const s=r[0];r.payload=parseInt(s.slice(1))}return r}const u=o({name:"Address",pattern:/[A-Z]/}),Ce=o({name:"G_Code",pattern:/G\d+(\.\d+)?/,longer_alt:u}),Me=o({name:"M_Code",pattern:/M\d+(\.)?/,longer_alt:u}),Se=o({name:"LineNumber",pattern:/N\d+/,longer_alt:u}),Ue=o({name:"ProgramNumber",pattern:Ft,line_breaks:!0}),Q=o({name:"Integer",pattern:/\d+/,categories:R}),Wt=o({name:"Decimal",pattern:/(?=\d*[.])([0-9]+\.?[0-9]*|\.[0-9]+)/,longer_alt:Q,categories:R}),Re=o({name:"BuiltinFunctions",pattern:/SIN|ASIN|COS|ACOS|TAN|ATAN|SQRT|ABS|BIN|BCD|ROUND|FIX|FUP|LN|EXP/,longer_alt:u}),$t=o({name:"WhiteSpace",pattern:/[\s\t\r]+/,group:H.SKIPPED}),z=o({name:"Comment",pattern:/\(\s*(.+?)\s*\)/,start_chars_hint:["("]}),Pe=o({name:"GotoLine",pattern:/GOTO[1-9][0-9]*/,longer_alt:u,categories:C}),we=o({name:"If",pattern:/IF/,longer_alt:u,categories:C}),ye=o({name:"Then",pattern:/THEN/,longer_alt:u,categories:C}),zt=o({name:"Do",pattern:/DO/,longer_alt:u,categories:C}),Xt=o({name:"While",pattern:/WHILE/,longer_alt:u,categories:C}),Ie=o({name:"Plus",pattern:"+",categories:B}),X=o({name:"Minus",pattern:"-",categories:B}),jt=o({name:"Divide",pattern:"/",categories:k}),Be=o({name:"Product",pattern:"*",categories:k}),ke=o({name:"Var",pattern:"#"}),Ge=o({name:"Equals",pattern:"="}),j=o({name:"Percent",pattern:"%"});o({name:"Dot",pattern:"."});const qt=o({name:"Comma",pattern:","}),U=o({name:"Newline",pattern:`
`}),q=[U,$t,j,z,wt,yt,kt,Gt,It,Bt,we,zt,ye,Xt,Pe,Re,ke,Ge,qt,jt,Be,X,Ie,Ce,Me,Se,Ue,u,Wt,Q,Vt,Dt,y,I,C,K,R,L,B,k];class Ve extends et{constructor(){super(q);this.program=this.RULE("program",()=>{this.SUBRULE(this.StartOfFile),this.SUBRULE(this.ProgramNumberLine),this.SUBRULE(this.lines),this.SUBRULE(this.EndOfFile)}),this.lines=this.RULE("lines",()=>{this.MANY_SEP({SEP:U,DEF:()=>this.SUBRULE(this.Line)})}),this.Line=this.RULE("Line",()=>{this.MANY(()=>{this.OR([{ALT:()=>this.CONSUME(Se)},{ALT:()=>this.CONSUME(Ce)},{ALT:()=>this.CONSUME(Me)},{ALT:()=>this.SUBRULE(this.AddressedValue)},{ALT:()=>this.SUBRULE(this.variableAssignment)},{ALT:()=>this.SUBRULE(this.conditionalExpression)},{ALT:()=>this.CONSUME(z)}])})}),this.AddressedValue=this.RULE("AddressedValue",()=>{this.CONSUME(u),this.OPTION(()=>{this.CONSUME(X)}),this.OR([{ALT:()=>this.CONSUME(R)},{ALT:()=>this.SUBRULE(this.VariableLiteral)},{ALT:()=>this.SUBRULE(this.bracketExpression)}])}),this.NumericLiteral=this.RULE("NumericLiteral",()=>{this.OPTION(()=>{this.CONSUME(X)}),this.CONSUME(R)}),this.VariableLiteral=this.RULE("VariableLiteral",()=>{this.CONSUME(ke),this.CONSUME(Q)}),this.ValueLiteral=this.RULE("ValueLiteral",()=>{this.OR([{ALT:()=>this.SUBRULE(this.VariableLiteral)},{ALT:()=>this.SUBRULE(this.NumericLiteral)}])}),this.ProgramNumberLine=this.RULE("ProgramNumberLine",()=>{this.CONSUME(Ue),this.CONSUME(z),this.CONSUME(U)}),this.expression=this.RULE("expression",()=>{this.SUBRULE(this.additionExpression)}),this.additionExpression=this.RULE("additionExpression",()=>{this.SUBRULE(this.multiplicationExpression,{LABEL:"lhs"}),this.MANY(()=>{this.CONSUME(B),this.SUBRULE2(this.multiplicationExpression,{LABEL:"rhs"})})}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{this.SUBRULE(this.atomicExpression,{LABEL:"lhs"}),this.MANY(()=>{this.CONSUME(k),this.SUBRULE2(this.atomicExpression,{LABEL:"rhs"})})}),this.functionExpression=this.RULE("functionExpression",()=>{this.CONSUME(Re),this.CONSUME(y),this.SUBRULE(this.atomicExpression),this.CONSUME(I)}),this.booleanExpression=this.RULE("booleanExpression",()=>{this.SUBRULE(this.atomicExpression),this.CONSUME(L),this.SUBRULE2(this.atomicExpression)}),this.conditionalExpression=this.RULE("conditionalExpression",()=>{this.CONSUME(we),this.CONSUME(y),this.SUBRULE(this.booleanExpression),this.CONSUME(I),this.OR([{ALT:()=>this.CONSUME(ye)},{ALT:()=>this.CONSUME(Pe)}])}),this.atomicExpression=this.RULE("atomicExpression",()=>{this.OR([{ALT:()=>this.SUBRULE(this.bracketExpression)},{ALT:()=>this.SUBRULE(this.functionExpression)},{ALT:()=>this.SUBRULE(this.NumericLiteral)},{ALT:()=>this.SUBRULE(this.VariableLiteral)}])}),this.bracketExpression=this.RULE("bracketExpression",()=>{this.CONSUME(y),this.SUBRULE(this.expression),this.CONSUME(I)}),this.variableAssignment=this.RULE("variableAssignment",()=>{this.SUBRULE(this.VariableLiteral),this.CONSUME(Ge),this.SUBRULE(this.expression)}),this.StartOfFile=this.RULE("StartOfFile",()=>{this.CONSUME(j),this.CONSUME(U)}),this.EndOfFile=this.RULE("EndOfFile",()=>{this.CONSUME(j),this.OPTION(()=>{this.CONSUME(U)})}),Ot("initializing"),this.performSelfAnalysis()}}const Ht=new Ve;class Yt{get prefix(){return this._address}get image(){return`${this._address}${this.value}`}constructor(e){if(this.value=NaN,this._address=g(e.Address),this._isNegative=Boolean(e==null?void 0:e.Minus),e!=null&&e.NumericValue){const r=this._isNegative?"-":"";this.value=xe(`${r}${g(e.NumericValue)}`)}return this}}const Zt=Ht.getBaseCstVisitorConstructorWithDefaults();class Kt extends Zt{constructor(e){super();var r;this.events=new be,this._insights=new _t,d("initializing"),this._mem=(r=e==null?void 0:e.memory)!=null?r:new Z,this.validateVisitor()}get Memory(){return this._mem}set Memory(e){this._mem=e}get Insights(){return this._insights}program(e){const r=this.ProgramNumberLine(e.ProgramNumberLine[0].children),s=this.lines(e.lines[0].children);return M(O({},r),{lines:s})}lines(e){const r=[];if(e.Line)for(const s of e.Line){const i=this.visit(s);r.push(i)}return r}ProgramNumberLine(e){const r=m(e.ProgramNumber),s=e!=null&&e.Comment?g(e.Comment):"";return{programTitle:de(s),programNumber:parseInt(r.payload)}}Line(e){const r={N:NaN,gCodes:[],mCodes:[],comments:[],addresses:[],gCodeMap:{},mCodeMap:{},addressMap:{}};if(e!=null&&e.LineNumber){const s=g(e.LineNumber);d(s),r.N=parseInt(xt(s))}if(e!=null&&e.G_Code&&e.G_Code.forEach(s=>{d(g(s)),r.gCodes.push(s),r.gCodeMap[s.image]=!0}),e!=null&&e.M_Code&&e.M_Code.forEach(s=>{d(g(s)),r.mCodes.push(s),r.mCodeMap[s.image]=!0}),e!=null&&e.variableAssignment){const{children:s}=m(e.variableAssignment);this.variableAssignment(s)}if(e!=null&&e.AddressedValue&&e.AddressedValue.forEach(({children:s})=>{const i=this.AddressedValue(s,r.gCodeMap);d(i),r.addresses.push(i),r.addressMap[i.prefix]=i.value}),e!=null&&e.Comment)for(const s of e.Comment){const i=g(s);d(i),r.comments.push(de(i))}if("G10"in r.gCodeMap){const{addressMap:s}=r;this._mem.g10({L:s.L,P:s.P,R:s.R,X:s.X,Y:s.Y,Z:s.Z,B:s.B})}return r}AddressedValue(e,r={}){const s=new Yt(e),i=new bt(s);return!At(r)&&!Te(r)&&this._insights.collect(i),s}NumericLiteral(e){const r=g(e.NumericValue),s=e.Minus?"-":"";return xe(`${s}${r}`)}VariableLiteral(e){var i;const r=parseInt(g(e.Integer));return{register:r,value:(i=this._mem.read(r))!=null?i:NaN}}ValueLiteral(e){let r=NaN;if(e.VariableLiteral){const{children:s}=m(e.VariableLiteral);r=this.VariableLiteral(s).value}if(e.NumericLiteral){const{children:s}=m(e.NumericLiteral);r=this.NumericLiteral(s)}return r}variableAssignment(e){const r=m(e.VariableLiteral).children,s=this.VariableLiteral(r);s.register,s.value;const i=m(e.expression).children,a=this.expression(i);this._mem.write(s.register,a)}expression(e){const{children:r}=m(e.additionExpression);return this.additionExpression(r)}functionExpression(e){const{children:r}=m(e.atomicExpression),s=g(e.BuiltinFunctions),i=this.atomicExpression(r);return _.match(s).with("LN",()=>Math.log(i)).with("ABS",()=>Math.abs(i)).with("FUP",()=>Math.ceil(i)).with("SQRT",()=>Math.sqrt(i)).with("FIX",()=>Math.floor(i)).with("ROUND",()=>Math.round(i)).with("SIN",()=>Math.sin(F(i))).with("COS",()=>Math.cos(F(i))).with("TAN",()=>Math.tan(F(i))).with("ASIN",()=>W(Math.asin(i))).with("ACOS",()=>W(Math.acos(i))).with("ATAN",()=>W(Math.atan(i))).otherwise(()=>NaN)}additionExpression(e){let r=this.visit(e.lhs);return e.rhs&&e.rhs.forEach((s,i)=>{const a=this.visit(s);if(e!=null&&e.AdditionOperator){const E=e.AdditionOperator[i];le(E,Ie)?(d(r,"+",a),r+=a):(d(r,"-",a),r-=a)}}),r}multiplicationExpression(e){let r=this.visit(e.lhs);return e.rhs&&e.rhs.forEach((s,i)=>{const a=this.visit(s);if(e!=null&&e.MultiplicationOperator){const E=e.MultiplicationOperator[i];le(E,Be)?(d(r,"*",a),r*=a):(d(r,"/",a),r/=a)}}),r}atomicExpression(e){return e.bracketExpression?this.bracketExpression(e.bracketExpression[0].children):e.NumericLiteral?this.NumericLiteral(e.NumericLiteral[0].children):e.functionExpression?this.functionExpression(e.functionExpression[0].children):e.VariableLiteral?this.VariableLiteral(e.VariableLiteral[0].children).value:NaN}bracketExpression(e){const{children:r}=m(e.expression);return this.expression(r)}}class De extends H{constructor(){vt(`initializing lexer with ${q.length} tokens`);super(q)}}new De;class Fe{get Lexer(){return this._lexer}get Parser(){return this._parser}get Interpreter(){return this._interpreter}get Memory(){return this._interpreter.Memory}constructor(){Nt("initializing"),this._mem=new Z,this._lexer=new De,this._parser=new Ve,this._interpreter=new Kt({memory:this._mem})}}class Qt{constructor(){this._activeProgram=NaN,this._lexerErrors=[],this._programs={},this._events=new be,ue("initializing"),this._env=new Fe}get Lexer(){return this._env.Lexer}get LexerErrors(){return this._lexerErrors}get Parser(){return this._env.Parser}get ParserErrors(){return this._env.Parser.errors}get Interpreter(){return this._env.Interpreter}get Memory(){return this._env.Memory}get Insights(){return this._env.Interpreter.Insights}run(){const e=new Date;this._tokenizeActiveProgram();const r=this.Parser.program();this.Parser.errors.length>0&&this._events.emit("error",this.Parser.errors);const s=this.Interpreter.program(r.children);return{beginExec:e,result:s}}reset(){this.Memory.reset(),this.Parser.input=[],this._activeProgram=NaN}getErrors(){return{parseErrors:this.ParserErrors,lexingErrors:this.LexerErrors}}onError(e){this._events.on("error",e)}loadParser(e){const{errors:r,tokens:s}=this.Lexer.tokenize(e);return r.length>0?{input:e,errors:r,tokens:[]}:(this.Parser.input=s,{input:e,tokens:s,errors:[]})}evalProgram(e){this._tokenizeForParsing(e);const r=this.Parser.program();return this.Interpreter.program(r.children)}evalLines(e){this._tokenizeForParsing(e);const r=this.Parser.lines();return this.Interpreter.lines(r.children)}getProgram(e){if(typeof e=="string")if(e.startsWith("O")){const r=e.replace(/^O/,"");return this._programs[parseInt(r)]}else return this._programs[parseInt(e)];else return this._programs[e]}getPrograms(){return this._programs}getProgramCount(){return Object.keys(this._programs).length}getActiveProgram(){return typeof this._activeProgram=="number"?this.getProgram(this._activeProgram):"No active program selected."}getActiveProgramNumber(){return this._activeProgram}setActiveProgram(e){ue(`Setting program #${e} active`),this._activeProgram=e}loadProgram(e,r){Ct(e,{NOMATCH:s=>this._emitError(s),MATCH:s=>{const i=parseInt(s[1]);return this._programs[i]=e,r!=null&&r.setActive&&(this.setActiveProgram(i),this._tokenizeActiveProgram()),this._programs[i]}})}loadPrograms(e){e.forEach(r=>this.loadProgram(r))}_emitError(e){return this._events.emit("error",e),!1}_tokenizeActiveProgram(){const e=this.getActiveProgram();this._tokenizeForParsing(e)}_tokenizeForParsing(e){const{errors:r,tokens:s}=this.Lexer.tokenize(e);r.length>0&&(this._lexerErrors.push(...r),this._events.emit("error",this._lexerErrors)),this.Parser.input=s}_parseProgramNumber(e){if(typeof e=="string")if(e.startsWith("O")){const r=e.replace(/^O/,"");return parseInt(r)}else return parseInt(e);else return e}}Lt();function Jt(){const t=new Qt;return h.exports.useState(t)}function ve(){return["( VARIABLE ASSIGNMENTS )","#1=3.141592654","","( ALGEBRA )","#2=[1+2]*3","","( VARIABLE SUBSTITUTIONS )","#3=#2/#1","#4=[4*#2]-3","#5=[6+#3+#2]/[#4-#2]","","( BUILT-IN FUNCTIONS )","#6=ABS[-2.3512]","#7=SQRT[49]","#8=ROUND[#1]","#9=FUP[#1]","","( EVAL G10 LINES) ","G10 G90 L2 P1 X1.2345 Y9.8765 Z-8.6753 B270.","G10 G90 L2 P2 X4.6234 Y3.8245 Z-7.2204 B90.","","( ... AND MORE! ) ",""].join(`
`)}function er(){const[t]=Jt(),{Memory:e}=t,[r,s]=h.exports.useState([]),i=h.exports.useRef(),[a,E]=h.exports.useState(20),[p,J]=h.exports.useState(1),[We,ee]=h.exports.useState([]),[$e,te]=h.exports.useState([]),[re,tr]=h.exports.useState([]),[ze,rr]=ft("gcode-dark"),[Xe,sr]=h.exports.useState({minimap:{enabled:!1}});t.onError(c=>{console.log(c)});function je(){J(p-1===0?1:p-1)}function qe(){J(p+1)}function se(){const c=e.toArray();if(p===1){const N=a*(p-1),v=N+a,G=c.slice(N,v),V=c.slice(v,v+13);ee(G),te(V)}else{const N=33+a*(p-2),v=N+a,G=c.slice(N,v),V=c.slice(v,v+a);ee(G),te(V)}}function ie(c){const N=t.evalLines(c);s(N),se()}function He(){throw new Error("Function not implemented.")}h.exports.useEffect(()=>{se()},[p,t.Memory]);const Ye=c=>{ie(String(c))},Ze=c=>{i.current=c,ie(ve())};return l("div",{className:"flex flex-col h-screen overflow-y-hidden bg-neutral-800",children:[l("div",{className:"flex flex-row font-bold text-purple-200 border-b border-b-purple-600 bg-violet-900",children:[n("div",{className:"flex-grow",children:n("h1",{className:"py-2 pl-4 text-2xl",children:"Fanuc Macro B Playground"})}),n("div",{children:n("button",{onClick:()=>He(),className:"w-32 py-2 text-white border-2 rounded-lg border-violet-600 bg-violet-700 disabled:text-gray-400 disabled:border-gray-600 disabled:bg-gray-500",children:"Macros"})})]}),l("div",{className:"flex flex-row flex-grow",children:[l("div",{className:"flex flex-col w-1/2 border-r border-r-purple-600",children:[l("p",{className:"px-6 py-3 text-sm italic border-b border-b-gray-900 text-violet-100",style:{backgroundColor:"#1E1E1E"},children:["\xBB"," Try editing some of the values!"]}),n(tt,{theme:ze,defaultLanguage:"gcode",options:Xe,defaultValue:ve(),onChange:Ye,onMount:Ze,beforeMount:pt}),re.length>0?l("div",{className:"px-4 py-2 bg-neutral-800",children:[n(nt,{errors:re})," "]}):void 0]}),l("div",{className:"flex flex-col flex-grow bg-neutral-800 ",children:[n(at,{memory:e}),l("div",{className:"p-2 text-yellow-100 border-t border-t-purple-600",children:[n("h1",{className:"pb-2 text-xl",children:"Debugging"}),JSON.stringify(e.toObject(),null,"  ")]}),l("div",{className:"container",children:[n("h1",{className:"px-2 py-3 text-3xl shadow-neutral-800 bg-neutral-800 text-violet-500",children:"Macro Registers"}),l("div",{className:"grid grid-flow-row grid-cols-2",children:[n("div",{className:"",children:n(he,{macros:We})}),n("div",{className:"",children:n(he,{macros:$e})})]}),l("div",{className:"flex flex-row justify-center py-4",children:[n("div",{className:"",children:n("button",{onClick:je,disabled:p===1,className:"w-32 py-2 text-white border-2 rounded-lg border-violet-600 bg-violet-700 disabled:text-gray-400 disabled:border-gray-600 disabled:bg-gray-500",children:"\xAB Page"})}),l("div",{className:"px-8 py-2 text-white",children:["Page ",n("span",{className:"text-violet-300",children:p})]}),n("div",{className:"",children:n("button",{onClick:qe,className:"w-32 py-2 text-white border-2 rounded-lg border-violet-600 bg-violet-700",children:"Page \xBB"})})]})]})]})]}),n("div",{className:"flex flex-row content-center text-purple-100 border-t border-t-purple-600 bg-violet-900",children:l("div",{className:"p-2 text-sm",children:["Made By"," ",n("a",{className:"text-purple-300 text-bold hover:text-white",href:"https://github.com/kevinkhill",children:"Kevin Hill"})," ","\xA9 2022"]})})]})}rt.render(n(st.StrictMode,{children:n(er,{})}),document.getElementById("root"));
