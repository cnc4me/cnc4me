var je=Object.defineProperty,qe=Object.defineProperties;var Ye=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var le=(t,e,r)=>e in t?je(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,b=(t,e)=>{for(var r in e||(e={}))ce.call(e,r)&&le(t,r,e[r]);if(D)for(var r of D(e))he.call(e,r)&&le(t,r,e[r]);return t},P=(t,e)=>qe(t,Ye(e));var Y=(t,e)=>{var r={};for(var s in t)ce.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&D)for(var s of D(t))e.indexOf(s)<0&&he.call(t,s)&&(r[s]=t[s]);return r};import{j as a,a as n,r as h,l as y,D as Ze,b as C,c as l,L as ie,C as Ke,e as be,t as de,u as Qe,i as Je,R as et,B as tt,d as rt}from"./vendor.a1c0e143.js";const st=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}};st();const Z=({href:t,children:e})=>n("a",{className:"text-purple-500 text-bold hover:text-purple-300",href:t,children:e}),it=()=>a("div",{className:"flex flex-row text-purple-100 bg-neutral-900",children:[a("div",{className:"p-2 text-sm",children:["View ",n(Z,{href:"https://github.com/cnc4me/cnc4me/tree/main/packages/fanuc-macro-b",children:"on Github"})]}),a("div",{className:"flex-grow text-center p-2 text-sm",children:[n(Z,{href:"https://github.com/cnc4me/cnc4me",children:"CNC 4 ME"})," \xA9 2022"]}),a("div",{className:"p-2 text-sm",children:["Made By ",n(Z,{href:"https://github.com/kevinkhill",children:"Kevin Hill"})]})]});function nt(t){return{registerCustomLanguage(e,r){return lt(t,e,r)},registerCustomTheme(e,r){return at(t,e,r)}}}function ot(t,e){return{brackets:t,tokenizer:{root:e}}}function Te(t,e={base:"vs",inherit:!1}){return b(b({},e),t)}function at(t,e,r){return t.editor.defineTheme(e,r),t}function lt(t,e,r){return t.languages.register({id:e}),t.languages.setMonarchTokensProvider(e,r),t}const ct=ot([["[","]","delimeter.bracket"]],[[/#\d/,"macro-var"],[/\(.+\)/,"comment"],[/G[0-9]+/,"keyword"],[/[\=\+\-\*\/]/,"operators"],[/(\d+(?:\.\d+)?)/,"number"]]),ht=Te({rules:[{token:"comment",foreground:"#C09D70",fontStyle:"italic"}],colors:{}},{base:"vs-dark",inherit:!0}),dt=Te({rules:[{token:"custom-info",foreground:"808080"},{token:"custom-error",foreground:"ff0000",fontStyle:"bold"},{token:"custom-notice",foreground:"FFA500"},{token:"custom-date",foreground:"008800"}],colors:{"editor.foreground":"#000000"}},{base:"vs",inherit:!1});function ut(t){const{registerCustomLanguage:e,registerCustomTheme:r}=nt(t);return t.languages.typescript.javascriptDefaults.setEagerModelSync(!0),e("gcode",ct),r("gcode-dark",ht),r("gcode-light",dt),t}function mt(t){const[e,r]=h.exports.useState(t);return[e,{setEditorThemeDark:()=>r("gcode-dark"),setEditorThemeLight:()=>r("gcode-light")}]}function gt(){return["( VARIABLE ASSIGNMENTS )","#1=3.141592654","","( ALGEBRA )","#2=[1+2]*3","","( VARIABLE SUBSTITUTIONS )","#3=#2/#1","#4=[4*#2]-3","#5=[6+#3+#2]/[#4-#2]","","( BUILT-IN FUNCTIONS )","#6=ABS[-2.3512]","#7=SQRT[49]","#8=ROUND[#1]","#9=FUP[#1]","","( EVAL G10 LINES FOR WORK OFFSETS ) ","G10 G90 L2 P1 X1.2345 Y9.8765 Z-8.6753 B270.","G10 G90 L2 P2 X4.6234 Y3.8245 Z-7.2204 B90.","","( OR FOR TOOL OFFSETS) ","G10 G90 L11 P1 R3.1235","G10 G90 L10 P1 R.5","G10 G90 L13 P1 R-.0025","G10 G90 L12 P1 R-.001","G10 G90 L11 P2 R5.3162","G10 G90 L10 P2 R.375","G10 G90 L13 P2 R.0012","G10 G90 L12 P2 R3.1235","G10 G90 L11 P3 R2.3903","G10 G90 L10 P3 R1.","G10 G90 L13 P3 R.375","G10 G90 L12 P3 R.004","","( AND MORE! ) ",""].join(`
`)}class pt{constructor(e){this.value=e.value,this.ctx=e.prefix}}class ft{constructor(){this._entries={}}collect(e){const r=this._entries[e.ctx];return Array.isArray(r)||(this._entries[e.ctx]=[]),this._entries[e.ctx].push(e),this.get(e.ctx).length}get(e){var r;return(r=this._entries[e])!=null?r:[]}values(e){return y.exports.map(this.get(e),"value")}uniqValues(e){return y.exports.uniq(this.values(e))}min(e){var r;return(r=y.exports.min(this.values(e)))!=null?r:NaN}max(e){var r;return(r=y.exports.max(this.values(e)))!=null?r:NaN}}const Et=Ze("macro"),M=t=>Et.extend(t),Nt=M("env"),Lt=M("lexer"),vt=M("parser"),_=M("memory"),ue=M("runtime"),p=M("interpreter");function f(t){return Array.isArray(t)?t[0]:t}function me(t){return t.replace(/^\(/,"").replace(/\)$/,"").trim()}function E(t){return f(t).image}function xt(t){return t.replace(/^[A-Z]/,"")}function _e(t){return t.includes(".")?parseFloat(t):parseInt(t)}function A(t,e){e=e+1;const r=(e-t)/1;return Array.from({length:r},(s,i)=>t+i)}function K(t){return t*Math.PI/180}function Q(t){return 180/Math.PI*t}function Ot(t){const e=[],r=new We;if(t!=null&&t.preloadInput){const{errors:s,tokens:i}=r.Lexer.tokenize(t.preloadInput);s&&s.push(...s),r.Parser.input=i}return{errors:e,lexer:r.Lexer,parser:r.Parser,interpreter:r.Interpreter}}function bt(t){return"G4"in t}function Ce(t){return"G10"in t}function Tt(t,{MATCH:e,NOMATCH:r}){const s=t.match(/^O([0-9]+)\s+?(?:\(.+?\))?$/m);return s===null?r("Program Number Not Found"):e(s)}const ge=20,Ae={X:1,Y:2,Z:3,B:4};function pe(t,e){if(t<10||t>13)throw Error("Invalid tool group value.");return t*1e3+e}function fe(t,e){if(t<0||t>6)throw Error(`Cannot compose a register from input: ${t}`);return{0:5200,1:5220,2:5240,3:5260,4:5280,5:5300,6:5320}[t]+Ae[e]}function Ee(t,e){const r=t*ge;return 7e3-ge+r+Ae[e]}const _t={LENGTH_COMP:10,LENGTH:11,DIAMETER_COMP:12,DIAMETER:13},Ct={COMMON:2,AUX:20},N={TOOL:_t,WORK:Ct};function At(t){const{addresses:e,gCodeMap:r}=t;if(!Ce(r))throw Error("G10 not found.");return e.reduce((s,i)=>P(b({},s),{[i.prefix]:i.value}),{})}function Mt(t){const{errors:e,parser:r,interpreter:s}=Ot({preloadInput:t});if(e.length>0)return{error:e[0].message,result:null};const i=r.lines(),o=s.lines(i.children);return{error:null,result:At(o[0])}}const St=4003,{WORK:Ne,TOOL:F}=N;function Le(t){return y.exports.pick(t,["X","Y","Z","B"])}const J=class{constructor(){this._vars={},this.write(St,90),this.reset()}read(t){const e=this._read(t);return _(`[READ ] #${t}= ${e}`),e}readBlocks(t,e){return A(t,t+e).map(r=>this.read(r))}write(t,e){_(`[WRITE] #${t}= ${e}`);const r=this._read(t);return this._write(t,e),{prev:r,curr:this._vars[t]}}clear(t){this._write(t,NaN)}reset(){J.REGISTERS.forEach(t=>this.clear(t)),_(`Initialized ${J.REGISTERS.length} registers`)}g10(t){return _("[ G10 ]",t),C.match(t).with({L:Ne.COMMON},s=>{var i=s,{P:e}=i,r=Y(i,["P"]);this.setCommonWorkOffset(e,Le(r))}).with({L:Ne.AUX},s=>{var i=s,{P:e}=i,r=Y(i,["P"]);this.setAuxWorkOffset(e,Le(r))}).with({L:F.LENGTH_COMP,R:C.__.number},({P:e,R:r})=>{this.setToolLengthComp(e,r)}).with({L:F.LENGTH,R:C.__.number},({P:e,R:r})=>{this.setToolLength(e,r)}).with({L:F.DIAMETER_COMP,R:C.__.number},({P:e,R:r})=>{this.setToolDiameterComp(e,r)}).with({L:F.DIAMETER,R:C.__.number},({P:e,R:r})=>{this.setToolDiameter(e,r)}).run()}evalG10(t){const{error:e,result:r}=Mt(t);if(r)this.g10(r);else throw Error(e)}getAxisLocations(t){if(t<53||t>59)throw Error(`${t} is not a valid Work Coordinate Group`);return this._getCommonWorkOffsetAxisLocations(t)}getWorkCoordinates(t){const{X:e,Y:r,Z:s,B:i}=this.getAxisLocations(t);return[e,r,s,i]}getAuxWorkCoordinates(t){if(t<1||t>299)throw Error(`${t} is not a valid Aux Work Coordinate Group`);return this._getAuxWorkOffsetAxisLocations(t)}getToolOffsets(t){return{length:this.getToolLength(t),diameter:this.getToolDiameter(t),lengthComp:this.getToolLengthComp(t),diameterComp:this.getToolDiameterComp(t)}}getToolOffsetArray(t){const{length:e,diameter:r,lengthComp:s,diameterComp:i}=this.getToolOffsets(t);return[t,e,r,s,i]}setToolLength(t,e){this._setToolOffsetValue(t,N.TOOL.LENGTH,e)}getToolLength(t){return this._getToolOffsetValueByGroup(t,N.TOOL.LENGTH)}setToolLengthComp(t,e){this._setToolOffsetValue(t,N.TOOL.LENGTH_COMP,e)}getToolLengthComp(t){return this._getToolOffsetValueByGroup(t,N.TOOL.LENGTH_COMP)}setToolDiameter(t,e){this._setToolOffsetValue(t,N.TOOL.DIAMETER,e)}getToolDiameter(t){return this._getToolOffsetValueByGroup(t,N.TOOL.DIAMETER)}setToolDiameterComp(t,e){this._setToolOffsetValue(t,N.TOOL.DIAMETER_COMP,e)}getToolDiameterComp(t){return this._getToolOffsetValueByGroup(t,N.TOOL.DIAMETER_COMP)}setCommonWorkOffset(t,e){_("[O-SET]",`G${t+53}=`,e),Object.entries(e).forEach(([r,s])=>{const i=fe(t,r);this.write(i,s)})}setAuxWorkOffset(t,e){_("[O-SET]",`G54.1 P${t}=`,e),Object.entries(e).forEach(([r,s])=>{const i=Ee(t,r);this.write(i,s)})}toArray(t){const e=[];return Object.entries(this._vars).forEach(([r,s])=>{const i=s===null||isNaN(s);(s||i&&(t==null?void 0:t.includeUnset))&&e.push([parseInt(r),s])}),e}toObject(t){const e={};for(const[r,s]of this.toArray(t))e[r]=s;return e}serialize(){return JSON.stringify(this._vars)}_write(t,e){this._vars[t]=e}_read(t){var e;return(e=this._vars[t])!=null?e:NaN}_setToolOffsetValue(t,e,r){const s=pe(e,t);this.write(s,r)}_getToolOffsetValueByGroup(t,e){const r=pe(e,t);return this.read(r)}_getCommonWorkOffsetAxisLocations(t){return["X","Y","Z","B"].reduce((e,r)=>{const s=fe(t-53,r);return P(b({},e),{[r]:this._vars[s]})},{})}_getAuxWorkOffsetAxisLocations(t){return["X","Y","Z","B"].reduce((e,r)=>{const s=Ee(t,r);return P(b({},e),{[r]:this._vars[s]})},{})}_increment(t,e){const r=this._vars[t];return this._vars[t]=r+e,{prev:r,curr:this._vars[t]}}};let ne=J;ne.REGISTERS=[...A(1,33),...A(100,199),...A(500,9999),...A(3e3,4999),...A(5e3,14e3)];const S=t=>l({name:t,pattern:ie.NA}),oe=S("Brackets"),B=S("NumericValue"),O=S("BooleanOperator"),X=S("AdditionOperator"),R=S("ControlFlowKeyword"),H=S("MultiplicationOperator"),Rt=l({name:"EqualTo",pattern:/EQ/,categories:O}),Ut=l({name:"NotEqualTo",pattern:/NE/,categories:O}),wt=l({name:"LessThan",pattern:/LT/,categories:O}),Pt=l({name:"LessThanOrEq",pattern:/LE/,categories:O}),yt=l({name:"GreaterThan",pattern:/GT/,categories:O}),Gt=l({name:"GreaterThanOrEq",pattern:/GE/,categories:O}),Bt=l({name:"OpenParen",pattern:"("}),It=l({name:"CloseParen",pattern:")"}),$=l({name:"OpenBracket",pattern:"[",categories:oe}),z=l({name:"CloseBracket",pattern:"]",categories:oe}),ve=/[O|:](\d+)/y;function kt(t,e){let r=null;if(ve.lastIndex=e,r=ve.exec(t),r!==null){const s=r[0];r.payload=parseInt(s.slice(1))}return r}const g=l({name:"Address",pattern:/[A-Z]/}),Me=l({name:"G_Code",pattern:/G\d+(\.\d+)?/,longer_alt:g}),Se=l({name:"M_Code",pattern:/M\d+(\.)?/,longer_alt:g}),Re=l({name:"LineNumber",pattern:/N\d+/,longer_alt:g}),Ue=l({name:"ProgramNumber",pattern:kt,line_breaks:!0}),ae=l({name:"Integer",pattern:/\d+/,categories:B}),Vt=l({name:"Decimal",pattern:/(?=\d*[.])([0-9]+\.?[0-9]*|\.[0-9]+)/,longer_alt:ae,categories:B}),we=l({name:"BuiltinFunctions",pattern:/SIN|ASIN|COS|ACOS|TAN|ATAN|SQRT|ABS|BIN|BCD|ROUND|FIX|FUP|LN|EXP/,longer_alt:g}),Dt=l({name:"WhiteSpace",pattern:/[\s\t\r]+/,group:ie.SKIPPED}),ee=l({name:"Comment",pattern:/\(\s*(.+?)\s*\)/,start_chars_hint:["("]}),Pe=l({name:"GotoLine",pattern:/GOTO[1-9][0-9]*/,longer_alt:g,categories:R}),ye=l({name:"If",pattern:/IF/,longer_alt:g,categories:R}),Ge=l({name:"Then",pattern:/THEN/,longer_alt:g,categories:R}),Ft=l({name:"Do",pattern:/DO/,longer_alt:g,categories:R}),Wt=l({name:"While",pattern:/WHILE/,longer_alt:g,categories:R}),Be=l({name:"Plus",pattern:"+",categories:X}),te=l({name:"Minus",pattern:"-",categories:X}),$t=l({name:"Divide",pattern:"/",categories:H}),Ie=l({name:"Product",pattern:"*",categories:H}),ke=l({name:"Var",pattern:"#"}),Ve=l({name:"Equals",pattern:"="}),re=l({name:"Percent",pattern:"%"});l({name:"Dot",pattern:"."});const zt=l({name:"Comma",pattern:","}),G=l({name:"Newline",pattern:`
`}),se=[G,Dt,re,ee,Rt,Ut,yt,Gt,wt,Pt,ye,Ft,Ge,Wt,Pe,we,ke,Ve,zt,$t,Ie,te,Be,Me,Se,Re,Ue,g,Vt,ae,Bt,It,$,z,R,oe,B,O,X,H];class De extends Ke{constructor(){super(se);this.program=this.RULE("program",()=>{this.SUBRULE(this.StartOfFile),this.SUBRULE(this.ProgramNumberLine),this.SUBRULE(this.lines),this.SUBRULE(this.EndOfFile)}),this.lines=this.RULE("lines",()=>{this.MANY_SEP({SEP:G,DEF:()=>this.SUBRULE(this.Line)})}),this.Line=this.RULE("Line",()=>{this.MANY(()=>{this.OR([{ALT:()=>this.CONSUME(Re)},{ALT:()=>this.CONSUME(Me)},{ALT:()=>this.CONSUME(Se)},{ALT:()=>this.SUBRULE(this.AddressedValue)},{ALT:()=>this.SUBRULE(this.variableAssignment)},{ALT:()=>this.SUBRULE(this.conditionalExpression)},{ALT:()=>this.CONSUME(ee)}])})}),this.AddressedValue=this.RULE("AddressedValue",()=>{this.CONSUME(g),this.OPTION(()=>{this.CONSUME(te)}),this.OR([{ALT:()=>this.CONSUME(B)},{ALT:()=>this.SUBRULE(this.VariableLiteral)},{ALT:()=>this.SUBRULE(this.bracketExpression)}])}),this.NumericLiteral=this.RULE("NumericLiteral",()=>{this.OPTION(()=>{this.CONSUME(te)}),this.CONSUME(B)}),this.VariableLiteral=this.RULE("VariableLiteral",()=>{this.CONSUME(ke),this.CONSUME(ae)}),this.ValueLiteral=this.RULE("ValueLiteral",()=>{this.OR([{ALT:()=>this.SUBRULE(this.VariableLiteral)},{ALT:()=>this.SUBRULE(this.NumericLiteral)}])}),this.ProgramNumberLine=this.RULE("ProgramNumberLine",()=>{this.CONSUME(Ue),this.CONSUME(ee),this.CONSUME(G)}),this.expression=this.RULE("expression",()=>{this.SUBRULE(this.additionExpression)}),this.additionExpression=this.RULE("additionExpression",()=>{this.SUBRULE(this.multiplicationExpression,{LABEL:"lhs"}),this.MANY(()=>{this.CONSUME(X),this.SUBRULE2(this.multiplicationExpression,{LABEL:"rhs"})})}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{this.SUBRULE(this.atomicExpression,{LABEL:"lhs"}),this.MANY(()=>{this.CONSUME(H),this.SUBRULE2(this.atomicExpression,{LABEL:"rhs"})})}),this.functionExpression=this.RULE("functionExpression",()=>{this.CONSUME(we),this.CONSUME($),this.SUBRULE(this.atomicExpression),this.CONSUME(z)}),this.booleanExpression=this.RULE("booleanExpression",()=>{this.SUBRULE(this.atomicExpression),this.CONSUME(O),this.SUBRULE2(this.atomicExpression)}),this.conditionalExpression=this.RULE("conditionalExpression",()=>{this.CONSUME(ye),this.CONSUME($),this.SUBRULE(this.booleanExpression),this.CONSUME(z),this.OR([{ALT:()=>this.CONSUME(Ge)},{ALT:()=>this.CONSUME(Pe)}])}),this.atomicExpression=this.RULE("atomicExpression",()=>{this.OR([{ALT:()=>this.SUBRULE(this.bracketExpression)},{ALT:()=>this.SUBRULE(this.functionExpression)},{ALT:()=>this.SUBRULE(this.NumericLiteral)},{ALT:()=>this.SUBRULE(this.VariableLiteral)}])}),this.bracketExpression=this.RULE("bracketExpression",()=>{this.CONSUME($),this.SUBRULE(this.expression),this.CONSUME(z)}),this.variableAssignment=this.RULE("variableAssignment",()=>{this.SUBRULE(this.VariableLiteral),this.CONSUME(Ve),this.SUBRULE(this.expression)}),this.StartOfFile=this.RULE("StartOfFile",()=>{this.CONSUME(re),this.CONSUME(G)}),this.EndOfFile=this.RULE("EndOfFile",()=>{this.CONSUME(re),this.OPTION(()=>{this.CONSUME(G)})}),vt("initializing"),this.performSelfAnalysis()}}const Xt=new De;class Ht{get prefix(){return this._address}get image(){return`${this._address}${this.value}`}constructor(e){if(this.value=NaN,this._address=E(e.Address),this._isNegative=Boolean(e==null?void 0:e.Minus),e!=null&&e.NumericValue){const r=this._isNegative?"-":"";this.value=_e(`${r}${E(e.NumericValue)}`)}return this}}const jt=Xt.getBaseCstVisitorConstructorWithDefaults();class qt extends jt{constructor(e){super();var r;this.events=new be,this._insights=new ft,p("initializing"),this._mem=(r=e==null?void 0:e.memory)!=null?r:new ne,this.validateVisitor()}get Memory(){return this._mem}set Memory(e){this._mem=e}get Insights(){return this._insights}program(e){const r=this.ProgramNumberLine(e.ProgramNumberLine[0].children),s=this.lines(e.lines[0].children);return P(b({},r),{lines:s})}lines(e){const r=[];if(e.Line)for(const s of e.Line){const i=this.visit(s);r.push(i)}return r}ProgramNumberLine(e){const r=f(e.ProgramNumber),s=e!=null&&e.Comment?E(e.Comment):"";return{programTitle:me(s),programNumber:parseInt(r.payload)}}Line(e){const r={N:NaN,gCodes:[],mCodes:[],comments:[],addresses:[],gCodeMap:{},mCodeMap:{},addressMap:{}};if(e!=null&&e.LineNumber){const s=E(e.LineNumber);p(s),r.N=parseInt(xt(s))}if(e!=null&&e.G_Code&&e.G_Code.forEach(s=>{p(E(s)),r.gCodes.push(s),r.gCodeMap[s.image]=!0}),e!=null&&e.M_Code&&e.M_Code.forEach(s=>{p(E(s)),r.mCodes.push(s),r.mCodeMap[s.image]=!0}),e!=null&&e.variableAssignment){const{children:s}=f(e.variableAssignment);this.variableAssignment(s)}if(e!=null&&e.AddressedValue&&e.AddressedValue.forEach(({children:s})=>{const i=this.AddressedValue(s,r.gCodeMap);p(i),r.addresses.push(i),r.addressMap[i.prefix]=i.value}),e!=null&&e.Comment)for(const s of e.Comment){const i=E(s);p(i),r.comments.push(me(i))}if("G10"in r.gCodeMap){const{addressMap:s}=r;this._mem.g10({L:s.L,P:s.P,R:s.R,X:s.X,Y:s.Y,Z:s.Z,B:s.B})}return r}AddressedValue(e,r={}){const s=new Ht(e),i=new pt(s);return!bt(r)&&!Ce(r)&&this._insights.collect(i),s}NumericLiteral(e){const r=E(e.NumericValue),s=e.Minus?"-":"";return _e(`${s}${r}`)}VariableLiteral(e){var i;const r=parseInt(E(e.Integer));return{register:r,value:(i=this._mem.read(r))!=null?i:NaN}}ValueLiteral(e){let r=NaN;if(e.VariableLiteral){const{children:s}=f(e.VariableLiteral);r=this.VariableLiteral(s).value}if(e.NumericLiteral){const{children:s}=f(e.NumericLiteral);r=this.NumericLiteral(s)}return r}variableAssignment(e){const r=f(e.VariableLiteral).children,s=this.VariableLiteral(r);s.register,s.value;const i=f(e.expression).children,o=this.expression(i);this._mem.write(s.register,o)}expression(e){const{children:r}=f(e.additionExpression);return this.additionExpression(r)}functionExpression(e){const{children:r}=f(e.atomicExpression),s=E(e.BuiltinFunctions),i=this.atomicExpression(r);return C.match(s).with("LN",()=>Math.log(i)).with("ABS",()=>Math.abs(i)).with("FUP",()=>Math.ceil(i)).with("SQRT",()=>Math.sqrt(i)).with("FIX",()=>Math.floor(i)).with("ROUND",()=>Math.round(i)).with("SIN",()=>Math.sin(K(i))).with("COS",()=>Math.cos(K(i))).with("TAN",()=>Math.tan(K(i))).with("ASIN",()=>Q(Math.asin(i))).with("ACOS",()=>Q(Math.acos(i))).with("ATAN",()=>Q(Math.atan(i))).otherwise(()=>NaN)}additionExpression(e){let r=this.visit(e.lhs);return e.rhs&&e.rhs.forEach((s,i)=>{const o=this.visit(s);if(e!=null&&e.AdditionOperator){const d=e.AdditionOperator[i];de(d,Be)?(p(r,"+",o),r+=o):(p(r,"-",o),r-=o)}}),r}multiplicationExpression(e){let r=this.visit(e.lhs);return e.rhs&&e.rhs.forEach((s,i)=>{const o=this.visit(s);if(e!=null&&e.MultiplicationOperator){const d=e.MultiplicationOperator[i];de(d,Ie)?(p(r,"*",o),r*=o):(p(r,"/",o),r/=o)}}),r}atomicExpression(e){return e.bracketExpression?this.bracketExpression(e.bracketExpression[0].children):e.NumericLiteral?this.NumericLiteral(e.NumericLiteral[0].children):e.functionExpression?this.functionExpression(e.functionExpression[0].children):e.VariableLiteral?this.VariableLiteral(e.VariableLiteral[0].children).value:NaN}bracketExpression(e){const{children:r}=f(e.expression);return this.expression(r)}}class Fe extends ie{constructor(){Lt(`initializing lexer with ${se.length} tokens`);super(se)}}new Fe;class We{get Lexer(){return this._lexer}get Parser(){return this._parser}get Interpreter(){return this._interpreter}get Memory(){return this._interpreter.Memory}constructor(){Nt("initializing"),this._mem=new ne,this._lexer=new Fe,this._parser=new De,this._interpreter=new qt({memory:this._mem})}}class Yt{constructor(){this._activeProgram=NaN,this._lexerErrors=[],this._programs={},this._events=new be,ue("initializing"),this._env=new We}get Lexer(){return this._env.Lexer}get LexerErrors(){return this._lexerErrors}get Parser(){return this._env.Parser}get ParserErrors(){return this._env.Parser.errors}get Interpreter(){return this._env.Interpreter}get Memory(){return this._env.Memory}get Insights(){return this._env.Interpreter.Insights}run(){const e=new Date;this._tokenizeActiveProgram();const r=this.Parser.program();this.Parser.errors.length>0&&this._events.emit("error",this.Parser.errors);const s=this.Interpreter.program(r.children);return{beginExec:e,result:s}}reset(){this.Memory.reset(),this.Parser.input=[],this._activeProgram=NaN}getErrors(){return{parseErrors:this.ParserErrors,lexingErrors:this.LexerErrors}}onError(e){this._events.on("error",e)}loadParser(e){const{errors:r,tokens:s}=this.Lexer.tokenize(e);return r.length>0?{input:e,errors:r,tokens:[]}:(this.Parser.input=s,{input:e,tokens:s,errors:[]})}evalProgram(e){this._tokenizeForParsing(e);const r=this.Parser.program();return this.Interpreter.program(r.children)}evalLines(e){this._tokenizeForParsing(e);const r=this.Parser.lines();return this.Interpreter.lines(r.children)}getProgram(e){if(typeof e=="string")if(e.startsWith("O")){const r=e.replace(/^O/,"");return this._programs[parseInt(r)]}else return this._programs[parseInt(e)];else return this._programs[e]}getPrograms(){return this._programs}getProgramCount(){return Object.keys(this._programs).length}getActiveProgram(){return typeof this._activeProgram=="number"?this.getProgram(this._activeProgram):"No active program selected."}getActiveProgramNumber(){return this._activeProgram}setActiveProgram(e){ue(`Setting program #${e} active`),this._activeProgram=e}loadProgram(e,r){Tt(e,{NOMATCH:s=>this._emitError(s),MATCH:s=>{const i=parseInt(s[1]);return this._programs[i]=e,r!=null&&r.setActive&&(this.setActiveProgram(i),this._tokenizeActiveProgram()),this._programs[i]}})}loadPrograms(e){e.forEach(r=>this.loadProgram(r))}_emitError(e){return this._events.emit("error",e),!1}_tokenizeActiveProgram(){const e=this.getActiveProgram();this._tokenizeForParsing(e)}_tokenizeForParsing(e){const{errors:r,tokens:s}=this.Lexer.tokenize(e);r.length>0&&(this._lexerErrors.push(...r),this._events.emit("error",this._lexerErrors)),this.Parser.input=s}_parseProgramNumber(e){if(typeof e=="string")if(e.startsWith("O")){const r=e.replace(/^O/,"");return parseInt(r)}else return parseInt(e);else return e}}const Zt=new Yt;function Kt(){return Zt}const Qt=()=>Qe().pathname.replace(/^\//,"");function I(t,e=8){return String(t).padStart(e,"0")}function W(t,e=4){return(Math.round(t*1e4)/1e4).toFixed(e)}function Jt(t,e){return Array.from({length:e-t+1},(r,s)=>s+1)}const xe=({group:t,locations:e})=>a("div",{className:"flex flex-row mb-1",children:[a("div",{className:"flex flex-col",children:[n("div",{className:"text-blue-400",children:I(t-53,3)}),n("div",{className:"text-blue-400",children:t===53?"EXT":`G${t}`})]}),n("div",{className:"flex flex-col flex-grow pr-10",children:Object.entries(e).map(([r,s])=>a("div",{className:"flex flex-row",children:[n("div",{className:"w-12 pt-px pr-3 text-right text-violet-100",children:r}),n("div",{className:"flex-grow pl-1 border-t border-l bg-violet-100 border-l-black border-t-black",children:s})]},r))})]}),j=({value:t})=>n("h1",{className:"pl-3 py-2 text-3xl border-b shadow-neutral-800 bg-neutral-900 border-b-violet-600 text-violet-500",children:t}),er=({memory:t})=>{const e=[53,54,55,56].map(s=>[s,t.getAxisLocations(s)]),r=[57,58,59].map(s=>[s,t.getAxisLocations(s)]);return a("div",{className:"container",children:[n(j,{value:"Work Coordinates"}),a("div",{className:"flex flex-col",children:[a("div",{className:"grid grid-flow-row grid-cols-2 px-4 pt-2 font-mono",children:[a("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]}),a("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]})]}),a("div",{className:"grid grid-flow-row grid-cols-2 px-4 pt-2 font-mono",children:[n("div",{children:e.map(([s,i])=>n(xe,{group:s,locations:i},s))}),n("div",{children:r.map(([s,i])=>n(xe,{group:s,locations:i},s))})]})]})]})},tr=({errors:t})=>a("div",{className:"",children:[n("h1",{className:"pb-1 text-xl font-bold text-violet-400",children:"Errors:"}),t.map((e,r)=>{const s=I(r+1,2);return a("div",{className:"flex flex-row font-mono text-xs",children:[a("div",{className:"font-bold text-red-400",children:["E",s,":"]}),n("div",{className:"text-red-600",children:n("pre",{children:JSON.stringify(e,null," ")})})]},s)})]}),rr=({memory:t,errors:e})=>a("div",{className:"container",children:[n(j,{value:"Debug"}),n("div",{className:"p-2 text-blue-400",children:n("pre",{children:JSON.stringify(t.toObject(),null,"  ")})}),n("div",{children:e.length>0?a("div",{className:"px-4 py-2 bg-neutral-800",children:[n(tr,{errors:e})," "]}):void 0})]}),Oe=({macros:t})=>a("div",{className:"flex flex-col gap-1 px-4 pt-2 font-mono",children:[a("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]}),t.map(e=>a("div",{className:"flex flex-row",children:[a("div",{className:"w-12 pt-px text-blue-400",children:["#",I(e[0],4)]}),n("div",{className:"flex-grow pl-1 border-t border-l bg-violet-100 border-l-black border-t-black",children:e[1].toFixed(10)})]},e[0]))]}),sr=({memory:t})=>{const[e,r]=h.exports.useState(1),[s,i]=h.exports.useState([]),[o,d]=h.exports.useState([]),T=()=>r(e-1===0?1:e-1),L=()=>r(e+1),U=()=>{const v=t.toArray({includeUnset:!0}),x=20;if(e===1){const u=x*(e-1),m=u+x,k=v.slice(u,m),w=v.slice(m,m+13);i(k),d(w)}else{const u=33+x*(e-2),m=u+x,k=v.slice(u,m),w=v.slice(m,m+x);i(k),d(w)}};return h.exports.useEffect(()=>{U()},[e,t]),a("div",{className:"container",children:[n(j,{value:"Macro Variables"}),a("div",{className:"grid grid-flow-row grid-cols-2",children:[n("div",{className:"",children:n(Oe,{macros:s})}),n("div",{className:"",children:n(Oe,{macros:o})})]}),a("div",{className:"flex flex-row justify-center py-4",children:[n("div",{className:"",children:n("button",{onClick:T,disabled:e===1,className:"w-32 py-2 text-white border-2 rounded-lg border-violet-600 bg-violet-700 disabled:text-gray-400 disabled:border-gray-600 disabled:bg-gray-500",children:"\xAB Page"})}),a("div",{className:"px-8 py-2 text-white",children:["Page ",n("span",{className:"text-violet-300",children:e})]}),n("div",{className:"",children:n("button",{onClick:L,className:"w-32 py-2 text-white border-2 rounded-lg border-violet-600 bg-violet-700",children:"Page \xBB"})})]})]})},ir=({memory:t})=>{const[e,r]=h.exports.useState(1),[s,i]=h.exports.useState(24),[o,d]=h.exports.useState(4),T=Jt(e,s).map(L=>t.getToolOffsetArray(L));return a("div",{className:"container",children:[n(j,{value:"Tools"}),a("div",{className:"font-mono flex flex-col flex-grow mt-2",children:[a("div",{className:"flex flex-row justify-around ml-12 mr-4",children:[n("div",{className:"text-blue-400",children:"(LENGTH)"}),n("div",{className:"text-blue-400",children:"(RADIUS)"})]}),a("div",{className:"flex flex-row text-center mr-4",children:[n("div",{className:"flex-shrink text-blue-400 pl-5",children:"NO."}),a("div",{className:"flex flex-row flex-grow",children:[n("div",{className:"flex-grow text-blue-400",children:"GEOM"}),n("div",{className:"flex-grow text-blue-400",children:"WEAR"}),n("div",{className:"flex-grow text-blue-400",children:"GEOM"}),n("div",{className:"flex-grow text-blue-400",children:"WEAR"})]})]}),n("div",{className:"flex flex-col px-4",children:T.map(L=>{const[U,v,x,u,m]=L;return a("div",{className:"flex gap-1",children:[n("div",{className:"flex-shrink text-blue-400",children:I(U,3)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:W(v,o)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:W(x,o)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:W(u,o)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:W(m,o)})]},I(L[0],3))})})]})]})};function nr(){const t=["macros","offsets","tools","debug"],e=gt(),r=Kt(),s=Qt(),i=t.includes(s)?s:"macros",[o,d]=h.exports.useState(i),T=h.exports.useRef(),[L]=mt("gcode-dark"),[U]=h.exports.useState({minimap:{enabled:!1}}),[v,x]=h.exports.useState([]),[u,m]=h.exports.useState(r.Memory),[k,w]=h.exports.useState([]);r.onError(c=>{console.log(c)});const q=c=>{const V=r.evalLines(c);w(V),m(r.Memory)},$e=c=>{T.current=c,q(e)},ze=c=>{q(String(c))},Xe=()=>{var V;const c=(V=T.current)==null?void 0:V.getValue();c&&q(String(c))},He=()=>o==="offsets"?n(er,{memory:u}):o==="macros"?n(sr,{memory:u}):o==="tools"?n(ir,{memory:u}):o==="debug"?n(rr,{memory:u,errors:v}):n("h1",{className:"text-red-600",children:"ERROR"});return a("div",{className:"flex flex-col h-screen overflow-y-hidden bg-neutral-800",children:[a("div",{className:"flex flex-row font-bold text-purple-200 bg-violet-900",children:[n("div",{className:"flex-grow",children:n("h1",{className:"py-2 pl-4 text-2xl",children:"Fanuc Macro B Playground"})}),n("div",{children:t.map(c=>n("button",{onClick:()=>d(c),className:`w-32 h-12 py-2 text-white ${o===c?"bg-neutral-900 rounded-tr-md rounded-tl-md":"bg-violet-900"}`,children:c.toUpperCase()},c))})]}),a("div",{className:"flex flex-row flex-grow",children:[a("div",{className:"flex flex-col w-1/2 border-r border-r-purple-600",children:[a("div",{className:"flex border-b border-b-gray-900 bg-[#1E1E1E]",children:[a("p",{className:"px-6 py-3 text-sm italic text-violet-100",children:["\xBB"," Try editing some of the values!"]}),n("div",{className:"flex-grow"}),a("button",{onClick:()=>Xe(),className:"px-3 mr-2 my-1.5 text-white border-1 rounded-md border-violet-600 bg-violet-700",children:["Run ","\u2BC8"]})]}),n(Je,{theme:L,defaultLanguage:"gcode",options:U,defaultValue:e,onMount:$e,onChange:ze,beforeMount:ut})]}),n("div",{className:"flex flex-col flex-grow bg-neutral-800",children:n(He,{})})]}),n("div",{className:"border-t border-t-purple-600",children:n(it,{})})]})}et.render(n(tt,{children:n(rt.StrictMode,{children:n(nr,{})})}),document.getElementById("root"));
