var He=Object.defineProperty,je=Object.defineProperties;var qe=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var ae=(t,e,r)=>e in t?He(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,T=(t,e)=>{for(var r in e||(e={}))le.call(e,r)&&ae(t,r,e[r]);if(D)for(var r of D(e))ce.call(e,r)&&ae(t,r,e[r]);return t},P=(t,e)=>je(t,qe(e));var q=(t,e)=>{var r={};for(var s in t)le.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&D)for(var s of D(t))e.indexOf(s)<0&&ce.call(t,s)&&(r[s]=t[s]);return r};import{r as h,D as Oe,l as y,a as _,c as a,L as re,C as Ye,e as be,t as he,j as o,b as n,i as Ze,R as Ke,B as Qe,d as Je}from"./vendor.3f192d00.js";const et=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function r(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerpolicy&&(l.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?l.credentials="include":i.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=r(i);fetch(i.href,l)}};et();function tt(t){return{registerCustomLanguage(e,r){return it(t,e,r)},registerCustomTheme(e,r){return st(t,e,r)}}}function rt(t,e){return{brackets:t,tokenizer:{root:e}}}function Te(t,e={base:"vs",inherit:!1}){return T(T({},e),t)}function st(t,e,r){return t.editor.defineTheme(e,r),t}function it(t,e,r){return t.languages.register({id:e}),t.languages.setMonarchTokensProvider(e,r),t}const nt=rt([["[","]","delimeter.bracket"]],[[/#\d/,"macro-var"],[/\(.+\)/,"comment"],[/[\=\+\-\*\/]/,"operators"],[/(\d+(?:\.\d+)?)/,"number"]]),ot=Te({rules:[{token:"comment",foreground:"#C09D70",fontStyle:"italic"}],colors:{}},{base:"vs-dark",inherit:!0}),at=Te({rules:[{token:"custom-info",foreground:"808080"},{token:"custom-error",foreground:"ff0000",fontStyle:"bold"},{token:"custom-notice",foreground:"FFA500"},{token:"custom-date",foreground:"008800"}],colors:{"editor.foreground":"#000000"}},{base:"vs",inherit:!1});function lt(t){const{registerCustomLanguage:e,registerCustomTheme:r}=tt(t);return t.languages.typescript.javascriptDefaults.setEagerModelSync(!0),e("gcode",nt),r("gcode-dark",ot),r("gcode-light",at),t}function ct(t){const[e,r]=h.exports.useState(t);return[e,{setEditorThemeDark:()=>r("gcode-dark"),setEditorThemeLight:()=>r("gcode-light")}]}function ht(){return["( VARIABLE ASSIGNMENTS )","#1=3.141592654","","( ALGEBRA )","#2=[1+2]*3","","( VARIABLE SUBSTITUTIONS )","#3=#2/#1","#4=[4*#2]-3","#5=[6+#3+#2]/[#4-#2]","","( BUILT-IN FUNCTIONS )","#6=ABS[-2.3512]","#7=SQRT[49]","#8=ROUND[#1]","#9=FUP[#1]","","( EVAL G10 LINES FOR WORK OFFSETS ) ","G10 G90 L2 P1 X1.2345 Y9.8765 Z-8.6753 B270.","G10 G90 L2 P2 X4.6234 Y3.8245 Z-7.2204 B90.","","( OR FOR TOOL OFFSETS) ","G10 G90 L11 P1 R3.1235","G10 G90 L10 P1 R.5","G10 G90 L13 P1 R-.0025","G10 G90 L12 P1 R-.001","G10 G90 L11 P2 R5.3162","G10 G90 L10 P2 R.375","G10 G90 L13 P2 R.0012","G10 G90 L12 P2 R3.1235","G10 G90 L11 P3 R2.3903","G10 G90 L10 P3 R1.","G10 G90 L13 P3 R.375","G10 G90 L12 P3 R.004","","( AND MORE! ) ",""].join(`
`)}const dt=Oe("macro"),M=t=>dt.extend(t),ut=t=>Oe.enable(t!=null?t:"macro:*"),mt=M("env"),gt=M("lexer"),pt=M("parser"),C=M("memory"),de=M("runtime"),g=M("interpreter");class ft{constructor(e){this.value=e.value,this.ctx=e.prefix}}class Et{constructor(){this._entries={}}collect(e){const r=this._entries[e.ctx];return Array.isArray(r)||(this._entries[e.ctx]=[]),this._entries[e.ctx].push(e),this.get(e.ctx).length}get(e){var r;return(r=this._entries[e])!=null?r:[]}values(e){return y.exports.map(this.get(e),"value")}uniqValues(e){return y.exports.uniq(this.values(e))}min(e){var r;return(r=y.exports.min(this.values(e)))!=null?r:NaN}max(e){var r;return(r=y.exports.max(this.values(e)))!=null?r:NaN}}function p(t){return Array.isArray(t)?t[0]:t}function ue(t){return t.replace(/^\(/,"").replace(/\)$/,"").trim()}function f(t){return p(t).image}function Nt(t){return t.replace(/^[A-Z]/,"")}function _e(t){return t.includes(".")?parseFloat(t):parseInt(t)}function S(t,e){e=e+1;const r=(e-t)/1;return Array.from({length:r},(s,i)=>t+i)}function Y(t){return t*Math.PI/180}function Z(t){return 180/Math.PI*t}function Lt(t){const e=[],r=new We;if(t!=null&&t.preloadInput){const{errors:s,tokens:i}=r.Lexer.tokenize(t.preloadInput);s&&s.push(...s),r.Parser.input=i}return{errors:e,lexer:r.Lexer,parser:r.Parser,interpreter:r.Interpreter}}function vt(t){return"G4"in t}function Ae(t){return"G10"in t}function xt(t,{MATCH:e,NOMATCH:r}){const s=t.match(/^O([0-9]+)\s+?(?:\(.+?\))?$/m);return s===null?r("Program Number Not Found"):e(s)}const me=20,Ce={X:1,Y:2,Z:3,B:4};function ge(t,e){if(t<10||t>13)throw Error("Invalid tool group value.");return t*1e3+e}function pe(t,e){if(t<0||t>6)throw Error(`Cannot compose a register from input: ${t}`);return{0:5200,1:5220,2:5240,3:5260,4:5280,5:5300,6:5320}[t]+Ce[e]}function fe(t,e){const r=t*me;return 7e3-me+r+Ce[e]}const Ot={LENGTH_COMP:10,LENGTH:11,DIAMETER_COMP:12,DIAMETER:13},bt={COMMON:2,AUX:20},N={TOOL:Ot,WORK:bt};function Tt(t){const{addresses:e,gCodeMap:r}=t;if(!Ae(r))throw Error("G10 not found.");return e.reduce((s,i)=>P(T({},s),{[i.prefix]:i.value}),{})}function _t(t){const{errors:e,parser:r,interpreter:s}=Lt({preloadInput:t});if(e.length>0)return{error:e[0].message,result:null};const i=r.lines(),l=s.lines(i.children);return{error:null,result:Tt(l[0])}}const At=4003,{WORK:Ee,TOOL:F}=N;function Ne(t){return y.exports.pick(t,["X","Y","Z","B"])}const K=class{constructor(){this._vars={},this.write(At,90),this.reset()}read(t){const e=this._read(t);return C(`[READ ] #${t}= ${e}`),e}readBlocks(t,e){return S(t,t+e).map(r=>this.read(r))}write(t,e){C(`[WRITE] #${t}= ${e}`);const r=this._read(t);return this._write(t,e),{prev:r,curr:this._vars[t]}}clear(t){this._write(t,NaN)}reset(){K.REGISTERS.forEach(t=>this.clear(t)),C(`Initialized ${K.REGISTERS.length} registers`)}g10(t){return C("[ G10 ]",t),_.match(t).with({L:Ee.COMMON},s=>{var i=s,{P:e}=i,r=q(i,["P"]);this.setCommonWorkOffset(e,Ne(r))}).with({L:Ee.AUX},s=>{var i=s,{P:e}=i,r=q(i,["P"]);this.setAuxWorkOffset(e,Ne(r))}).with({L:F.LENGTH_COMP,R:_.__.number},({P:e,R:r})=>{this.setToolLengthComp(e,r)}).with({L:F.LENGTH,R:_.__.number},({P:e,R:r})=>{this.setToolLength(e,r)}).with({L:F.DIAMETER_COMP,R:_.__.number},({P:e,R:r})=>{this.setToolDiameterComp(e,r)}).with({L:F.DIAMETER,R:_.__.number},({P:e,R:r})=>{this.setToolDiameter(e,r)}).run()}evalG10(t){const{error:e,result:r}=_t(t);if(r)this.g10(r);else throw Error(e)}getAxisLocations(t){if(t<53||t>59)throw Error(`${t} is not a valid Work Coordinate Group`);return this._getCommonWorkOffsetAxisLocations(t)}getWorkCoordinates(t){const{X:e,Y:r,Z:s,B:i}=this.getAxisLocations(t);return[e,r,s,i]}getAuxWorkCoordinates(t){if(t<1||t>299)throw Error(`${t} is not a valid Aux Work Coordinate Group`);return this._getAuxWorkOffsetAxisLocations(t)}getToolOffsets(t){return{length:this.getToolLength(t),diameter:this.getToolDiameter(t),lengthComp:this.getToolLengthComp(t),diameterComp:this.getToolDiameterComp(t)}}getToolOffsetArray(t){const{length:e,diameter:r,lengthComp:s,diameterComp:i}=this.getToolOffsets(t);return[t,e,r,s,i]}setToolLength(t,e){this._setToolOffsetValue(t,N.TOOL.LENGTH,e)}getToolLength(t){return this._getToolOffsetValueByGroup(t,N.TOOL.LENGTH)}setToolLengthComp(t,e){this._setToolOffsetValue(t,N.TOOL.LENGTH_COMP,e)}getToolLengthComp(t){return this._getToolOffsetValueByGroup(t,N.TOOL.LENGTH_COMP)}setToolDiameter(t,e){this._setToolOffsetValue(t,N.TOOL.DIAMETER,e)}getToolDiameter(t){return this._getToolOffsetValueByGroup(t,N.TOOL.DIAMETER)}setToolDiameterComp(t,e){this._setToolOffsetValue(t,N.TOOL.DIAMETER_COMP,e)}getToolDiameterComp(t){return this._getToolOffsetValueByGroup(t,N.TOOL.DIAMETER_COMP)}setCommonWorkOffset(t,e){C("[O-SET]",`G${t+53}=`,e),Object.entries(e).forEach(([r,s])=>{const i=pe(t,r);this.write(i,s)})}setAuxWorkOffset(t,e){C("[O-SET]",`G54.1 P${t}=`,e),Object.entries(e).forEach(([r,s])=>{const i=fe(t,r);this.write(i,s)})}toArray(t){const e=[];return Object.entries(this._vars).forEach(([r,s])=>{const i=s===null||isNaN(s);(s||i&&(t==null?void 0:t.includeUnset))&&e.push([parseInt(r),s])}),e}toObject(t){const e={};for(const[r,s]of this.toArray(t))e[r]=s;return e}serialize(){return JSON.stringify(this._vars)}_write(t,e){this._vars[t]=e}_read(t){var e;return(e=this._vars[t])!=null?e:NaN}_setToolOffsetValue(t,e,r){const s=ge(e,t);this.write(s,r)}_getToolOffsetValueByGroup(t,e){const r=ge(e,t);return this.read(r)}_getCommonWorkOffsetAxisLocations(t){return["X","Y","Z","B"].reduce((e,r)=>{const s=pe(t-53,r);return P(T({},e),{[r]:this._vars[s]})},{})}_getAuxWorkOffsetAxisLocations(t){return["X","Y","Z","B"].reduce((e,r)=>{const s=fe(t,r);return P(T({},e),{[r]:this._vars[s]})},{})}_increment(t,e){const r=this._vars[t];return this._vars[t]=r+e,{prev:r,curr:this._vars[t]}}};let se=K;se.REGISTERS=[...S(1,33),...S(100,199),...S(500,9999),...S(3e3,4999),...S(5e3,14e3)];const R=t=>a({name:t,pattern:re.NA}),ie=R("Brackets"),B=R("NumericValue"),b=R("BooleanOperator"),X=R("AdditionOperator"),U=R("ControlFlowKeyword"),H=R("MultiplicationOperator"),Ct=a({name:"EqualTo",pattern:/EQ/,categories:b}),St=a({name:"NotEqualTo",pattern:/NE/,categories:b}),Mt=a({name:"LessThan",pattern:/LT/,categories:b}),Rt=a({name:"LessThanOrEq",pattern:/LE/,categories:b}),Ut=a({name:"GreaterThan",pattern:/GT/,categories:b}),wt=a({name:"GreaterThanOrEq",pattern:/GE/,categories:b}),Pt=a({name:"OpenParen",pattern:"("}),yt=a({name:"CloseParen",pattern:")"}),$=a({name:"OpenBracket",pattern:"[",categories:ie}),z=a({name:"CloseBracket",pattern:"]",categories:ie}),Le=/[O|:](\d+)/y;function Gt(t,e){let r=null;if(Le.lastIndex=e,r=Le.exec(t),r!==null){const s=r[0];r.payload=parseInt(s.slice(1))}return r}const m=a({name:"Address",pattern:/[A-Z]/}),Se=a({name:"G_Code",pattern:/G\d+(\.\d+)?/,longer_alt:m}),Me=a({name:"M_Code",pattern:/M\d+(\.)?/,longer_alt:m}),Re=a({name:"LineNumber",pattern:/N\d+/,longer_alt:m}),Ue=a({name:"ProgramNumber",pattern:Gt,line_breaks:!0}),ne=a({name:"Integer",pattern:/\d+/,categories:B}),Bt=a({name:"Decimal",pattern:/(?=\d*[.])([0-9]+\.?[0-9]*|\.[0-9]+)/,longer_alt:ne,categories:B}),we=a({name:"BuiltinFunctions",pattern:/SIN|ASIN|COS|ACOS|TAN|ATAN|SQRT|ABS|BIN|BCD|ROUND|FIX|FUP|LN|EXP/,longer_alt:m}),It=a({name:"WhiteSpace",pattern:/[\s\t\r]+/,group:re.SKIPPED}),Q=a({name:"Comment",pattern:/\(\s*(.+?)\s*\)/,start_chars_hint:["("]}),Pe=a({name:"GotoLine",pattern:/GOTO[1-9][0-9]*/,longer_alt:m,categories:U}),ye=a({name:"If",pattern:/IF/,longer_alt:m,categories:U}),Ge=a({name:"Then",pattern:/THEN/,longer_alt:m,categories:U}),kt=a({name:"Do",pattern:/DO/,longer_alt:m,categories:U}),Vt=a({name:"While",pattern:/WHILE/,longer_alt:m,categories:U}),Be=a({name:"Plus",pattern:"+",categories:X}),J=a({name:"Minus",pattern:"-",categories:X}),Dt=a({name:"Divide",pattern:"/",categories:H}),Ie=a({name:"Product",pattern:"*",categories:H}),ke=a({name:"Var",pattern:"#"}),Ve=a({name:"Equals",pattern:"="}),ee=a({name:"Percent",pattern:"%"});a({name:"Dot",pattern:"."});const Ft=a({name:"Comma",pattern:","}),G=a({name:"Newline",pattern:`
`}),te=[G,It,ee,Q,Ct,St,Ut,wt,Mt,Rt,ye,kt,Ge,Vt,Pe,we,ke,Ve,Ft,Dt,Ie,J,Be,Se,Me,Re,Ue,m,Bt,ne,Pt,yt,$,z,U,ie,B,b,X,H];class De extends Ye{constructor(){super(te);this.program=this.RULE("program",()=>{this.SUBRULE(this.StartOfFile),this.SUBRULE(this.ProgramNumberLine),this.SUBRULE(this.lines),this.SUBRULE(this.EndOfFile)}),this.lines=this.RULE("lines",()=>{this.MANY_SEP({SEP:G,DEF:()=>this.SUBRULE(this.Line)})}),this.Line=this.RULE("Line",()=>{this.MANY(()=>{this.OR([{ALT:()=>this.CONSUME(Re)},{ALT:()=>this.CONSUME(Se)},{ALT:()=>this.CONSUME(Me)},{ALT:()=>this.SUBRULE(this.AddressedValue)},{ALT:()=>this.SUBRULE(this.variableAssignment)},{ALT:()=>this.SUBRULE(this.conditionalExpression)},{ALT:()=>this.CONSUME(Q)}])})}),this.AddressedValue=this.RULE("AddressedValue",()=>{this.CONSUME(m),this.OPTION(()=>{this.CONSUME(J)}),this.OR([{ALT:()=>this.CONSUME(B)},{ALT:()=>this.SUBRULE(this.VariableLiteral)},{ALT:()=>this.SUBRULE(this.bracketExpression)}])}),this.NumericLiteral=this.RULE("NumericLiteral",()=>{this.OPTION(()=>{this.CONSUME(J)}),this.CONSUME(B)}),this.VariableLiteral=this.RULE("VariableLiteral",()=>{this.CONSUME(ke),this.CONSUME(ne)}),this.ValueLiteral=this.RULE("ValueLiteral",()=>{this.OR([{ALT:()=>this.SUBRULE(this.VariableLiteral)},{ALT:()=>this.SUBRULE(this.NumericLiteral)}])}),this.ProgramNumberLine=this.RULE("ProgramNumberLine",()=>{this.CONSUME(Ue),this.CONSUME(Q),this.CONSUME(G)}),this.expression=this.RULE("expression",()=>{this.SUBRULE(this.additionExpression)}),this.additionExpression=this.RULE("additionExpression",()=>{this.SUBRULE(this.multiplicationExpression,{LABEL:"lhs"}),this.MANY(()=>{this.CONSUME(X),this.SUBRULE2(this.multiplicationExpression,{LABEL:"rhs"})})}),this.multiplicationExpression=this.RULE("multiplicationExpression",()=>{this.SUBRULE(this.atomicExpression,{LABEL:"lhs"}),this.MANY(()=>{this.CONSUME(H),this.SUBRULE2(this.atomicExpression,{LABEL:"rhs"})})}),this.functionExpression=this.RULE("functionExpression",()=>{this.CONSUME(we),this.CONSUME($),this.SUBRULE(this.atomicExpression),this.CONSUME(z)}),this.booleanExpression=this.RULE("booleanExpression",()=>{this.SUBRULE(this.atomicExpression),this.CONSUME(b),this.SUBRULE2(this.atomicExpression)}),this.conditionalExpression=this.RULE("conditionalExpression",()=>{this.CONSUME(ye),this.CONSUME($),this.SUBRULE(this.booleanExpression),this.CONSUME(z),this.OR([{ALT:()=>this.CONSUME(Ge)},{ALT:()=>this.CONSUME(Pe)}])}),this.atomicExpression=this.RULE("atomicExpression",()=>{this.OR([{ALT:()=>this.SUBRULE(this.bracketExpression)},{ALT:()=>this.SUBRULE(this.functionExpression)},{ALT:()=>this.SUBRULE(this.NumericLiteral)},{ALT:()=>this.SUBRULE(this.VariableLiteral)}])}),this.bracketExpression=this.RULE("bracketExpression",()=>{this.CONSUME($),this.SUBRULE(this.expression),this.CONSUME(z)}),this.variableAssignment=this.RULE("variableAssignment",()=>{this.SUBRULE(this.VariableLiteral),this.CONSUME(Ve),this.SUBRULE(this.expression)}),this.StartOfFile=this.RULE("StartOfFile",()=>{this.CONSUME(ee),this.CONSUME(G)}),this.EndOfFile=this.RULE("EndOfFile",()=>{this.CONSUME(ee),this.OPTION(()=>{this.CONSUME(G)})}),pt("initializing"),this.performSelfAnalysis()}}const Wt=new De;class $t{get prefix(){return this._address}get image(){return`${this._address}${this.value}`}constructor(e){if(this.value=NaN,this._address=f(e.Address),this._isNegative=Boolean(e==null?void 0:e.Minus),e!=null&&e.NumericValue){const r=this._isNegative?"-":"";this.value=_e(`${r}${f(e.NumericValue)}`)}return this}}const zt=Wt.getBaseCstVisitorConstructorWithDefaults();class Xt extends zt{constructor(e){super();var r;this.events=new be,this._insights=new Et,g("initializing"),this._mem=(r=e==null?void 0:e.memory)!=null?r:new se,this.validateVisitor()}get Memory(){return this._mem}set Memory(e){this._mem=e}get Insights(){return this._insights}program(e){const r=this.ProgramNumberLine(e.ProgramNumberLine[0].children),s=this.lines(e.lines[0].children);return P(T({},r),{lines:s})}lines(e){const r=[];if(e.Line)for(const s of e.Line){const i=this.visit(s);r.push(i)}return r}ProgramNumberLine(e){const r=p(e.ProgramNumber),s=e!=null&&e.Comment?f(e.Comment):"";return{programTitle:ue(s),programNumber:parseInt(r.payload)}}Line(e){const r={N:NaN,gCodes:[],mCodes:[],comments:[],addresses:[],gCodeMap:{},mCodeMap:{},addressMap:{}};if(e!=null&&e.LineNumber){const s=f(e.LineNumber);g(s),r.N=parseInt(Nt(s))}if(e!=null&&e.G_Code&&e.G_Code.forEach(s=>{g(f(s)),r.gCodes.push(s),r.gCodeMap[s.image]=!0}),e!=null&&e.M_Code&&e.M_Code.forEach(s=>{g(f(s)),r.mCodes.push(s),r.mCodeMap[s.image]=!0}),e!=null&&e.variableAssignment){const{children:s}=p(e.variableAssignment);this.variableAssignment(s)}if(e!=null&&e.AddressedValue&&e.AddressedValue.forEach(({children:s})=>{const i=this.AddressedValue(s,r.gCodeMap);g(i),r.addresses.push(i),r.addressMap[i.prefix]=i.value}),e!=null&&e.Comment)for(const s of e.Comment){const i=f(s);g(i),r.comments.push(ue(i))}if("G10"in r.gCodeMap){const{addressMap:s}=r;this._mem.g10({L:s.L,P:s.P,R:s.R,X:s.X,Y:s.Y,Z:s.Z,B:s.B})}return r}AddressedValue(e,r={}){const s=new $t(e),i=new ft(s);return!vt(r)&&!Ae(r)&&this._insights.collect(i),s}NumericLiteral(e){const r=f(e.NumericValue),s=e.Minus?"-":"";return _e(`${s}${r}`)}VariableLiteral(e){var i;const r=parseInt(f(e.Integer));return{register:r,value:(i=this._mem.read(r))!=null?i:NaN}}ValueLiteral(e){let r=NaN;if(e.VariableLiteral){const{children:s}=p(e.VariableLiteral);r=this.VariableLiteral(s).value}if(e.NumericLiteral){const{children:s}=p(e.NumericLiteral);r=this.NumericLiteral(s)}return r}variableAssignment(e){const r=p(e.VariableLiteral).children,s=this.VariableLiteral(r);s.register,s.value;const i=p(e.expression).children,l=this.expression(i);this._mem.write(s.register,l)}expression(e){const{children:r}=p(e.additionExpression);return this.additionExpression(r)}functionExpression(e){const{children:r}=p(e.atomicExpression),s=f(e.BuiltinFunctions),i=this.atomicExpression(r);return _.match(s).with("LN",()=>Math.log(i)).with("ABS",()=>Math.abs(i)).with("FUP",()=>Math.ceil(i)).with("SQRT",()=>Math.sqrt(i)).with("FIX",()=>Math.floor(i)).with("ROUND",()=>Math.round(i)).with("SIN",()=>Math.sin(Y(i))).with("COS",()=>Math.cos(Y(i))).with("TAN",()=>Math.tan(Y(i))).with("ASIN",()=>Z(Math.asin(i))).with("ACOS",()=>Z(Math.acos(i))).with("ATAN",()=>Z(Math.atan(i))).otherwise(()=>NaN)}additionExpression(e){let r=this.visit(e.lhs);return e.rhs&&e.rhs.forEach((s,i)=>{const l=this.visit(s);if(e!=null&&e.AdditionOperator){const d=e.AdditionOperator[i];he(d,Be)?(g(r,"+",l),r+=l):(g(r,"-",l),r-=l)}}),r}multiplicationExpression(e){let r=this.visit(e.lhs);return e.rhs&&e.rhs.forEach((s,i)=>{const l=this.visit(s);if(e!=null&&e.MultiplicationOperator){const d=e.MultiplicationOperator[i];he(d,Ie)?(g(r,"*",l),r*=l):(g(r,"/",l),r/=l)}}),r}atomicExpression(e){return e.bracketExpression?this.bracketExpression(e.bracketExpression[0].children):e.NumericLiteral?this.NumericLiteral(e.NumericLiteral[0].children):e.functionExpression?this.functionExpression(e.functionExpression[0].children):e.VariableLiteral?this.VariableLiteral(e.VariableLiteral[0].children).value:NaN}bracketExpression(e){const{children:r}=p(e.expression);return this.expression(r)}}class Fe extends re{constructor(){gt(`initializing lexer with ${te.length} tokens`);super(te)}}new Fe;class We{get Lexer(){return this._lexer}get Parser(){return this._parser}get Interpreter(){return this._interpreter}get Memory(){return this._interpreter.Memory}constructor(){mt("initializing"),this._mem=new se,this._lexer=new Fe,this._parser=new De,this._interpreter=new Xt({memory:this._mem})}}class Ht{constructor(){this._activeProgram=NaN,this._lexerErrors=[],this._programs={},this._events=new be,de("initializing"),this._env=new We}get Lexer(){return this._env.Lexer}get LexerErrors(){return this._lexerErrors}get Parser(){return this._env.Parser}get ParserErrors(){return this._env.Parser.errors}get Interpreter(){return this._env.Interpreter}get Memory(){return this._env.Memory}get Insights(){return this._env.Interpreter.Insights}run(){const e=new Date;this._tokenizeActiveProgram();const r=this.Parser.program();this.Parser.errors.length>0&&this._events.emit("error",this.Parser.errors);const s=this.Interpreter.program(r.children);return{beginExec:e,result:s}}reset(){this.Memory.reset(),this.Parser.input=[],this._activeProgram=NaN}getErrors(){return{parseErrors:this.ParserErrors,lexingErrors:this.LexerErrors}}onError(e){this._events.on("error",e)}loadParser(e){const{errors:r,tokens:s}=this.Lexer.tokenize(e);return r.length>0?{input:e,errors:r,tokens:[]}:(this.Parser.input=s,{input:e,tokens:s,errors:[]})}evalProgram(e){this._tokenizeForParsing(e);const r=this.Parser.program();return this.Interpreter.program(r.children)}evalLines(e){this._tokenizeForParsing(e);const r=this.Parser.lines();return this.Interpreter.lines(r.children)}getProgram(e){if(typeof e=="string")if(e.startsWith("O")){const r=e.replace(/^O/,"");return this._programs[parseInt(r)]}else return this._programs[parseInt(e)];else return this._programs[e]}getPrograms(){return this._programs}getProgramCount(){return Object.keys(this._programs).length}getActiveProgram(){return typeof this._activeProgram=="number"?this.getProgram(this._activeProgram):"No active program selected."}getActiveProgramNumber(){return this._activeProgram}setActiveProgram(e){de(`Setting program #${e} active`),this._activeProgram=e}loadProgram(e,r){xt(e,{NOMATCH:s=>this._emitError(s),MATCH:s=>{const i=parseInt(s[1]);return this._programs[i]=e,r!=null&&r.setActive&&(this.setActiveProgram(i),this._tokenizeActiveProgram()),this._programs[i]}})}loadPrograms(e){e.forEach(r=>this.loadProgram(r))}_emitError(e){return this._events.emit("error",e),!1}_tokenizeActiveProgram(){const e=this.getActiveProgram();this._tokenizeForParsing(e)}_tokenizeForParsing(e){const{errors:r,tokens:s}=this.Lexer.tokenize(e);r.length>0&&(this._lexerErrors.push(...r),this._events.emit("error",this._lexerErrors)),this.Parser.input=s}_parseProgramNumber(e){if(typeof e=="string")if(e.startsWith("O")){const r=e.replace(/^O/,"");return parseInt(r)}else return parseInt(e);else return e}}ut();const jt=new Ht;function qt(){return jt}function I(t,e=8){return String(t).padStart(e,"0")}function W(t,e=4){return(Math.round(t*1e4)/1e4).toFixed(e)}function Yt(t,e){return Array.from({length:e-t+1},(r,s)=>s+1)}const Zt=({errors:t})=>o("div",{className:"",children:[n("h1",{className:"pb-1 text-xl font-bold text-violet-400",children:"Errors:"}),t.map((e,r)=>{const s=I(r+1,2);return o("div",{className:"flex flex-row font-mono text-xs",children:[o("div",{className:"font-bold text-red-400",children:["E",s,":"]}),n("div",{className:"text-red-600",children:n("pre",{children:JSON.stringify(e,null," ")})})]},s)})]}),j=({value:t})=>n("h1",{className:"pl-3 py-2 text-3xl border-b shadow-neutral-800 bg-neutral-900 border-b-violet-600 text-violet-500",children:t}),Kt=({memory:t,errors:e})=>o("div",{className:"container",children:[n(j,{value:"Debug"}),n("div",{className:"p-2 text-blue-400",children:n("pre",{children:JSON.stringify(t.toObject(),null,"  ")})}),n("div",{children:e.length>0?o("div",{className:"px-4 py-2 bg-neutral-800",children:[n(Zt,{errors:e})," "]}):void 0})]}),ve=({macros:t})=>o("div",{className:"flex flex-col gap-1 px-4 pt-2 font-mono",children:[o("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]}),t.map(e=>o("div",{className:"flex flex-row",children:[o("div",{className:"w-12 pt-px text-blue-400",children:["#",I(e[0],4)]}),n("div",{className:"flex-grow pl-1 border-t border-l bg-violet-100 border-l-black border-t-black",children:e[1].toFixed(10)})]},e[0]))]}),Qt=({memory:t})=>{const[e,r]=h.exports.useState(1),[s,i]=h.exports.useState([]),[l,d]=h.exports.useState([]),L=()=>r(e-1===0?1:e-1),v=()=>r(e+1),k=()=>{const x=t.toArray({includeUnset:!0}),E=20;if(e===1){const O=E*(e-1),u=O+E,A=x.slice(O,u),w=x.slice(u,u+13);i(A),d(w)}else{const O=33+E*(e-2),u=O+E,A=x.slice(O,u),w=x.slice(u,u+E);i(A),d(w)}};return h.exports.useEffect(()=>{k()},[e,t]),o("div",{className:"container",children:[n(j,{value:"Macro Variables"}),o("div",{className:"grid grid-flow-row grid-cols-2",children:[n("div",{className:"",children:n(ve,{macros:s})}),n("div",{className:"",children:n(ve,{macros:l})})]}),o("div",{className:"flex flex-row justify-center py-4",children:[n("div",{className:"",children:n("button",{onClick:L,disabled:e===1,className:"w-32 py-2 text-white border-2 rounded-lg border-violet-600 bg-violet-700 disabled:text-gray-400 disabled:border-gray-600 disabled:bg-gray-500",children:"\xAB Page"})}),o("div",{className:"px-8 py-2 text-white",children:["Page ",n("span",{className:"text-violet-300",children:e})]}),n("div",{className:"",children:n("button",{onClick:v,className:"w-32 py-2 text-white border-2 rounded-lg border-violet-600 bg-violet-700",children:"Page \xBB"})})]})]})},xe=({group:t,locations:e})=>o("div",{className:"flex flex-row mb-1",children:[o("div",{className:"flex flex-col",children:[n("div",{className:"text-blue-400",children:I(t-53,3)}),n("div",{className:"text-blue-400",children:t===53?"EXT":`G${t}`})]}),n("div",{className:"flex flex-col flex-grow pr-10",children:Object.entries(e).map(([r,s])=>o("div",{className:"flex flex-row",children:[n("div",{className:"w-12 pt-px pr-3 text-right text-violet-100",children:r}),n("div",{className:"flex-grow pl-1 border-t border-l bg-violet-100 border-l-black border-t-black",children:s})]},r))})]}),Jt=({memory:t})=>{const e=[53,54,55,56].map(s=>[s,t.getAxisLocations(s)]),r=[57,58,59].map(s=>[s,t.getAxisLocations(s)]);return o("div",{className:"container",children:[n(j,{value:"Work Coordinates"}),n("div",{className:"flex flex-col",children:n("div",{className:"pb-4 border-t border-t-purple-600",children:o("div",{className:"container",children:[o("div",{className:"grid grid-flow-row grid-cols-2 px-4 pt-2 font-mono",children:[o("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]}),o("div",{className:"flex flex-row",children:[n("div",{className:"w-12 text-violet-100",children:"NO."}),n("div",{className:"pl-1 text-violet-100",children:"DATA"})]})]}),o("div",{className:"grid grid-flow-row grid-cols-2 px-4 pt-2 font-mono",children:[n("div",{children:e.map(([s,i])=>n(xe,{group:s,locations:i},s))}),n("div",{children:r.map(([s,i])=>n(xe,{group:s,locations:i},s))})]})]})})})]})},er=({memory:t})=>{const[e,r]=h.exports.useState(1),[s,i]=h.exports.useState(24),[l,d]=h.exports.useState(4),L=Yt(e,s).map(v=>t.getToolOffsetArray(v));return o("div",{className:"container",children:[n(j,{value:"Tools"}),o("div",{className:"font-mono flex flex-col flex-grow mt-2",children:[o("div",{className:"flex flex-row justify-around ml-12 mr-4",children:[n("div",{className:"text-blue-400",children:"(LENGTH)"}),n("div",{className:"text-blue-400",children:"(RADIUS)"})]}),o("div",{className:"flex flex-row text-center mr-4",children:[n("div",{className:"flex-shrink text-blue-400 pl-5",children:"NO."}),o("div",{className:"flex flex-row flex-grow",children:[n("div",{className:"flex-grow text-blue-400",children:"GEOM"}),n("div",{className:"flex-grow text-blue-400",children:"WEAR"}),n("div",{className:"flex-grow text-blue-400",children:"GEOM"}),n("div",{className:"flex-grow text-blue-400",children:"WEAR"})]})]}),n("div",{className:"flex flex-col px-4",children:L.map(v=>{const[k,x,E,O,u]=v;return o("div",{className:"flex gap-1",children:[n("div",{className:"flex-shrink text-blue-400",children:I(k,3)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:W(x,l)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:W(E,l)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:W(O,l)}),n("div",{className:"flex-1 pr-1 text-right bg-white border-t border-l border-t-gray-700 border-l-gray-700",children:W(u,l)})]},I(v[0],3))})})]})]})};function tr(){const t=ht(),e=qt(),r=h.exports.useRef(),[s,i]=ct("gcode-dark"),[l,d]=h.exports.useState({minimap:{enabled:!1}}),[L,v]=h.exports.useState(e.Memory),[k,x]=h.exports.useState([]),[E,O]=h.exports.useState([]);e.onError(c=>{console.log(c)});const u=["macros","offsets","tools","debug"],[A,w]=h.exports.useState("macros"),oe=c=>{const V=e.evalLines(c);x(V),v(e.Memory)},$e=c=>{r.current=c},ze=c=>{oe(String(c))};function Xe(){var V;const c=(V=r.current)==null?void 0:V.getValue();c&&oe(String(c))}return o("div",{className:"flex flex-col h-screen overflow-y-hidden bg-neutral-800",children:[o("div",{className:"flex flex-row font-bold text-purple-200 bg-violet-900",children:[n("div",{className:"flex-grow",children:n("h1",{className:"py-2 pl-4 text-2xl",children:"Fanuc Macro B Playground"})}),n("div",{children:u.map(c=>n("button",{onClick:()=>w(c),className:`w-32 h-12 py-2 text-white ${A===c?"bg-neutral-900 rounded-tr-md rounded-tl-md":"bg-violet-900"}`,children:c.toUpperCase()},c))})]}),o("div",{className:"flex flex-row flex-grow",children:[o("div",{className:"flex flex-col w-1/2 border-r border-r-purple-600",children:[o("div",{className:"flex border-b border-b-gray-900 bg-[#1E1E1E]",children:[o("p",{className:"px-6 py-3 text-sm italic text-violet-100",children:["\xBB"," Try editing some of the values!"]}),n("div",{className:"flex-grow"}),o("button",{onClick:()=>Xe(),className:"px-3 mr-2 my-1.5 text-white border-1 rounded-md border-violet-600 bg-violet-700",children:["Run ","\u2BC8"]})]}),n(Ze,{theme:s,defaultLanguage:"gcode",options:l,defaultValue:t,onMount:$e,onChange:ze,beforeMount:lt})]}),n("div",{className:"flex flex-col flex-grow bg-neutral-800",children:_.match(A).with("offsets",()=>n(Jt,{memory:L})).with("macros",()=>n(Qt,{memory:L})).with("tools",()=>n(er,{memory:L})).with("debug",()=>n(Kt,{memory:L,errors:E})).otherwise(()=>n("h1",{className:"text-red-600",children:"ERROR"}))})]}),o("div",{className:"flex flex-row text-purple-100 border-t border-t-purple-600 bg-neutral-900",children:[o("div",{className:"p-2 text-sm",children:["View the"," ",n("a",{className:"text-purple-600 text-bold hover:text-purple-400",href:"https://github.com/cnc4me/cnc4me/tree/main/packages/fanuc-macro-b",children:"Parser"})," ","on Github"]}),o("div",{className:"flex-grow text-center p-2 text-sm",children:[n("a",{className:"text-purple-600 text-bold hover:text-purple-400",href:"https://github.com/cnc4me/cnc4me",children:"CNC 4 ME"})," ","\xA9 2022"]}),o("div",{className:"p-2 text-sm",children:["Made By"," ",n("a",{className:"text-purple-600 text-bold hover:text-purple-400",href:"https://github.com/kevinkhill",children:"Kevin Hill"})]})]})]})}Ke.render(n(Qe,{children:n(Je.StrictMode,{children:n(tr,{})})}),document.getElementById("root"));
